<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI教學平台｜大學教學專用｜Grok & DeepSeek 雙核驅動</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <style>
    /* 色彩系統 */
    :root {
      /* 主色系 - 教學藍紫調 */
      --primary: #4f46e5;      /* Indigo */
      --secondary: #7c3aed;    /* Purple */
      --accent: #06b6d4;       /* Cyan */
      --success: #10b981;      /* Emerald */
      --warning: #f59e0b;      /* Amber */
      --danger: #ef4444;       /* Red */
      --info: #3b82f6;         /* Blue */
      
      /* 背景系統 */
      --bg-primary: #f8fafc;   /* Light */
      --bg-secondary: #f1f5f9; /* Slightly darker */
      --bg-card: #ffffff;      /* White */
      --bg-modal: rgba(0, 0, 0, 0.5);
      
      /* 文字系統 */
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --text-light: #94a3b8;
      
      /* 邊框與陰影 */
      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;
      --border-dark: #94a3b8;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      
      /* 圓角系統 */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-full: 9999px;
      
      /* 動畫速度 */
      --transition-fast: 150ms;
      --transition-normal: 300ms;
      --transition-slow: 500ms;
    }
    
    /* 深色模式支援 */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-card: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-light: #334155;
        --border-medium: #475569;
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
      }
    }
    
    /* 基礎重置 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      font-size: 16px;
      scroll-behavior: smooth;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 
                   'Noto Sans TC', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* 容器系統 */
    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    @media (min-width: 768px) {
      .container {
        padding: 1.5rem;
      }
    }
    
    @media (min-width: 1024px) {
      .container {
        padding: 2rem;
      }
    }
    
    /* 標題區域 */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border-radius: var(--radius-xl);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .header-content {
      position: relative;
      z-index: 1;
    }
    
    .header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .header-subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 1rem;
    }
    
    .header-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    /* 徽章系統 */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }
    
    .badge-primary {
      background: rgba(79, 70, 229, 0.1);
      color: var(--primary);
      border: 1px solid rgba(79, 70, 229, 0.2);
    }
    
    .badge-secondary {
      background: rgba(124, 58, 237, 0.1);
      color: var(--secondary);
      border: 1px solid rgba(124, 58, 237, 0.2);
    }
    
    .badge-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }
    
    .badge-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    .badge-info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    /* 導航系統 */
    .main-nav {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      background: var(--bg-card);
      padding: 1rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }
    
    .nav-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: var(--bg-secondary);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      white-space: nowrap;
    }
    
    .nav-btn:hover {
      background: var(--bg-card);
      border-color: var(--primary);
      color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .nav-btn.active {
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
      border-color: var(--primary);
      color: var(--primary);
    }
    
    /* 內容區域 */
    .content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* 卡片系統 */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border-light);
    }
    
    .card-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* 網格系統 */
    .grid {
      display: grid;
      gap: 1.5rem;
    }
    
    .grid-2 {
      grid-template-columns: repeat(1, 1fr);
    }
    
    .grid-3 {
      grid-template-columns: repeat(1, 1fr);
    }
    
    @media (min-width: 768px) {
      .grid-2 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .grid-3 {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (min-width: 1024px) {
      .grid-3 {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    /* 表單系統 */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.875rem;
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.875rem;
      transition: all var(--transition-fast);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      background: var(--bg-card);
    }
    
    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }
    
    /* 按鈕系統 */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      text-decoration: none;
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    
    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }
    
    .btn:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      100% {
        transform: scale(20, 20);
        opacity: 0;
      }
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-outline {
      background: transparent;
      color: var(--text-secondary);
      border: 2px solid var(--border-medium);
    }
    
    .btn-outline:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }
    
    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1rem;
    }
    
    .btn-full {
      width: 100%;
    }
    
    .btn-group {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }
    
    /* 工具列 */
    .toolbar {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      padding: 1rem 0;
      border-top: 1px solid var(--border-light);
      margin-top: 1.5rem;
    }
    
    /* 狀態指示器 */
    .status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border-radius: var(--radius-md);
      font-weight: 500;
      font-size: 0.875rem;
      margin: 0.5rem 0;
    }
    
    .status-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .status-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }
    
    .status-error {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    .status-info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    /* API回應區域 */
    .api-response {
      background: var(--bg-secondary);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 1rem;
      min-height: 200px;
      max-height: 500px;
      overflow-y: auto;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    /* 模型選擇器 */
    .model-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .model-card {
      background: var(--bg-card);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      text-align: center;
    }
    
    .model-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }
    
    .model-card.active {
      border-color: var(--primary);
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.05), rgba(124, 58, 237, 0.05));
    }
    
    .model-icon {
      width: 64px;
      height: 64px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      font-size: 1.5rem;
    }
    
    .grok-icon {
      background: rgba(79, 70, 229, 0.1);
      color: var(--primary);
    }
    
    .deepseek-icon {
      background: rgba(6, 182, 212, 0.1);
      color: var(--accent);
    }
    
    .model-name {
      font-weight: 700;
      font-size: 1.125rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    .model-desc {
      color: var(--text-muted);
      font-size: 0.875rem;
      line-height: 1.4;
      margin-bottom: 1rem;
    }
    
    /* 流程指示器 - 修正版 */
    .process-flow {
      display: flex;
      justify-content: space-between;
      position: relative;
      margin: 2rem 0;
      padding: 0 1rem;
    }
    
    .process-flow::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 50px;
      right: 50px;
      height: 4px;
      background: var(--border-light);
      z-index: 1;
    }
    
    .process-step {
      text-align: center;
      position: relative;
      z-index: 2;
      flex: 1;
      cursor: pointer;
      transition: all var(--transition-normal);
    }
    
    .process-step:hover .step-number {
      transform: scale(1.1);
      box-shadow: var(--shadow-md);
    }
    
    .step-number {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      margin: 0 auto 0.5rem;
      border: 3px solid var(--bg-card);
      transition: all var(--transition-normal);
    }
    
    .process-step.active .step-number {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      transform: scale(1.1);
    }
    
    .step-label {
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    .process-step.active .step-label {
      color: var(--primary);
    }
    
    /* 加載動畫 */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text-muted);
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-light);
      border-top-color: var(--primary);
      border-radius: var(--radius-full);
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* 教學模板 */
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .template-card {
      background: var(--bg-card);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      cursor: pointer;
      transition: all var(--transition-normal);
    }
    
    .template-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: var(--primary);
    }
    
    .template-icon {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }
    
    .template-title {
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    .template-desc {
      color: var(--text-muted);
      font-size: 0.875rem;
      line-height: 1.4;
    }
    
    /* 測試結果顯示 */
    .test-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .test-card {
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      text-align: center;
    }
    
    .test-icon {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    
    .test-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }
    
    .test-value {
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--text-primary);
    }
    
    /* 推理模式開關 */
    .reasoning-toggle {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(79, 70, 229, 0.05);
      border-radius: var(--radius-md);
      border: 2px solid rgba(79, 70, 229, 0.1);
      margin: 1rem 0;
    }
    
    .reasoning-toggle input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: var(--primary);
    }
    
    /* 模態窗 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-modal);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }
    
    .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: 2rem;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border-light);
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-muted);
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      transition: all var(--transition-fast);
    }
    
    .modal-close:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    
    /* 代碼高亮 */
    .code-block {
      background: #1e293b;
      color: #e2e8f0;
      border-radius: var(--radius-md);
      padding: 1rem;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      overflow-x: auto;
      margin: 1rem 0;
    }
    
    .code-keyword { color: #f472b6; }
    .code-string { color: #86efac; }
    .code-comment { color: #94a3b8; }
    .code-function { color: #60a5fa; }
    .code-number { color: #fbbf24; }
    
    /* API金鑰管理 */
    .api-key-manager {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 1rem 0;
    }
    
    .key-display {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 2px solid var(--border-light);
      margin-bottom: 1rem;
    }
    
    .key-value {
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      color: var(--text-secondary);
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .key-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    /* 響應式調整 */
    @media (max-width: 640px) {
      .header h1 {
        font-size: 1.5rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .nav-btn {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
      }
      
      .process-flow {
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }
      
      .process-step {
        flex: 0 0 calc(33.333% - 1rem);
      }
      
      .process-flow::before {
        display: none;
      }
    }
    
    /* 列印樣式 */
    @media print {
      .main-nav,
      .toolbar,
      .btn:not(.btn-print),
      .modal,
      .reasoning-toggle {
        display: none !important;
      }
      
      .content {
        display: block !important;
        break-inside: avoid;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid #ccc;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 標題區 -->
    <div class="header">
      <div class="header-content">
        <h1>
          <i class="fas fa-robot"></i>
          AI教學平台｜大學教學專用
          <div class="header-badges">
            <span class="badge badge-primary">Grok 4.1 Fast</span>
            <span class="badge badge-secondary">DeepSeek</span>
            <span class="badge badge-success">教學優化</span>
          </div>
        </h1>
        <p class="header-subtitle">
          專為大學教學設計的完整AI教學平台，整合Grok推理模式與DeepSeek免費API，提供從問題分析到教學資源生成的完整流程。
        </p>
        <div class="header-badges">
          <span class="badge badge-info"><i class="fas fa-shield-alt"></i> 穩定教學環境</span>
          <span class="badge badge-warning"><i class="fas fa-graduation-cap"></i> 完整教學流程</span>
          <span class="badge badge-danger"><i class="fas fa-network-wired"></i> 離線備援模式</span>
        </div>
      </div>
    </div>
    
    <!-- 修正的流程指示器 -->
    <div class="process-flow">
      <div class="process-step active" data-tab="home">
        <div class="step-number">1</div>
        <div class="step-label">首頁總覽</div>
      </div>
      <div class="process-step" data-tab="model">
        <div class="step-number">2</div>
        <div class="step-label">模型設定</div>
      </div>
      <div class="process-step" data-tab="api">
        <div class="step-number">3</div>
        <div class="step-label">AI分析</div>
      </div>
      <div class="process-step" data-tab="ipo">
        <div class="step-number">4</div>
        <div class="step-label">IPO設計</div>
      </div>
      <div class="process-step" data-tab="code">
        <div class="step-number">5</div>
        <div class="step-label">程式生成</div>
      </div>
      <div class="process-step" data-tab="teach">
        <div class="step-number">6</div>
        <div class="step-label">教學資源</div>
      </div>
    </div>
    
    <!-- 主導航 -->
    <nav class="main-nav">
      <button class="nav-btn active" data-tab="home">
        <i class="fas fa-home"></i> 首頁總覽
      </button>
      <button class="nav-btn" data-tab="model">
        <i class="fas fa-brain"></i> 模型設定
      </button>
      <button class="nav-btn" data-tab="api">
        <i class="fas fa-robot"></i> AI分析
      </button>
      <button class="nav-btn" data-tab="ipo">
        <i class="fas fa-sitemap"></i> IPO設計
      </button>
      <button class="nav-btn" data-tab="code">
        <i class="fas fa-code"></i> 程式生成
      </button>
      <button class="nav-btn" data-tab="teach">
        <i class="fas fa-chalkboard-teacher"></i> 教學資源
      </button>
      <button class="nav-btn" data-tab="test">
        <i class="fas fa-vial"></i> 系統測試
      </button>
    </nav>
    
    <!-- 首頁總覽 -->
    <section id="home" class="content active">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-rocket"></i> 快速開始教學流程</h2>
          <span class="badge badge-success">推薦路徑</span>
        </div>
        
        <div class="grid grid-2">
          <!-- 左欄：系統狀態 -->
          <div>
            <div class="form-group">
              <label class="form-label"><i class="fas fa-cogs"></i> 系統狀態</label>
              <div class="test-results">
                <div class="test-card">
                  <div class="test-icon" style="color: var(--success)">
                    <i class="fas fa-plug"></i>
                  </div>
                  <div class="test-label">API連線</div>
                  <div class="test-value" id="statusConnection">待測試</div>
                </div>
                <div class="test-card">
                  <div class="test-icon" style="color: var(--primary)">
                    <i class="fas fa-brain"></i>
                  </div>
                  <div class="test-label">當前模型</div>
                  <div class="test-value" id="statusModel">未選擇</div>
                </div>
                <div class="test-card">
                  <div class="test-icon" style="color: var(--info)">
                    <i class="fas fa-key"></i>
                  </div>
                  <div class="test-label">API金鑰</div>
                  <div class="test-value" id="statusApiKey">未設定</div>
                </div>
                <div class="test-card">
                  <div class="test-icon" style="color: var(--warning)">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="test-label">教學進度</div>
                  <div class="test-value" id="statusProgress">0%</div>
                </div>
              </div>
            </div>
            
            <!-- API金鑰永久儲存管理 -->
            <div class="api-key-manager">
              <div class="form-group">
                <label class="form-label"><i class="fas fa-key"></i> API金鑰管理</label>
                
                <div class="key-display">
                  <div class="key-value" id="deepseekKeyDisplay">
                    DeepSeek: 未設定
                  </div>
                  <div class="key-actions">
                    <button class="btn btn-sm btn-outline" id="editDeepseekKey">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline" id="testDeepseekKey">
                      <i class="fas fa-vial"></i>
                    </button>
                  </div>
                </div>
                
                <div class="key-display">
                  <div class="key-value" id="openrouterKeyDisplay">
                    OpenRouter: 未設定
                  </div>
                  <div class="key-actions">
                    <button class="btn btn-sm btn-outline" id="editOpenrouterKey">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline" id="testOpenrouterKey">
                      <i class="fas fa-vial"></i>
                    </button>
                  </div>
                </div>
                
                <div class="btn-group">
                  <button class="btn btn-primary" id="quickSetup">
                    <i class="fas fa-magic"></i> 快速設定
                  </button>
                  <button class="btn btn-outline" id="exportKeys">
                    <i class="fas fa-download"></i> 匯出金鑰
                  </button>
                  <button class="btn btn-outline" id="importKeys">
                    <i class="fas fa-upload"></i> 匯入金鑰
                  </button>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label"><i class="fas fa-shield-alt"></i> 安全性設定</label>
              <div class="btn-group">
                <button class="btn btn-outline" id="clearLocalData">
                  <i class="fas fa-trash"></i> 清除本地資料
                </button>
                <button class="btn btn-outline" id="backupData">
                  <i class="fas fa-save"></i> 備份設定
                </button>
              </div>
            </div>
          </div>
          
          <!-- 右欄：教學模板 -->
          <div>
            <div class="form-group">
              <label class="form-label"><i class="fas fa-magic"></i> 教學模板快速開始</label>
              <div class="templates-grid">
                <div class="template-card" data-template="calculator">
                  <div class="template-icon"><i class="fas fa-calculator"></i></div>
                  <div class="template-title">計算器程式</div>
                  <div class="template-desc">基礎IPO分析與程式設計教學，適合初學者</div>
                </div>
                <div class="template-card" data-template="student">
                  <div class="template-icon"><i class="fas fa-user-graduate"></i></div>
                  <div class="template-title">學生成績系統</div>
                  <div class="template-desc">資料結構與CRUD操作教學</div>
                </div>
                <div class="template-card" data-template="quiz">
                  <div class="template-icon"><i class="fas fa-question-circle"></i></div>
                  <div class="template-title">測驗系統</div>
                  <div class="template-desc">演算法與評分邏輯教學</div>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label"><i class="fas fa-play-circle"></i> 快速操作</label>
              <div class="btn-group">
                <button class="btn btn-success btn-lg" id="quickStart">
                  <i class="fas fa-play"></i> 開始教學流程
                </button>
                <button class="btn btn-outline" id="demoMode">
                  <i class="fas fa-eye"></i> 演示模式
                </button>
                <button class="btn btn-outline" id="resetProgress">
                  <i class="fas fa-redo"></i> 重置進度
                </button>
              </div>
            </div>
            
            <div id="homeStatus"></div>
          </div>
        </div>
      </div>
      
      <!-- 教學說明 -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-graduation-cap"></i> 教學平台使用說明</h2>
        </div>
        <div class="grid grid-3">
          <div>
            <h3><i class="fas fa-1"></i> 模型設定</h3>
            <p>選擇AI模型並設定API金鑰。Grok適合展示推理過程，DeepSeek適合實際開發。</p>
            <button class="btn btn-sm btn-outline" onclick="platform.switchTab('model')">
              前往設定
            </button>
          </div>
          <div>
            <h3><i class="fas fa-2"></i> AI分析</h3>
            <p>使用AI協助進行問題拆解，生成詳細的IPO（Input-Process-Output）分析。</p>
            <button class="btn btn-sm btn-outline" onclick="platform.switchTab('api')">
              開始分析
            </button>
          </div>
          <div>
            <h3><i class="fas fa-3"></i> IPO設計</h3>
            <p>根據AI分析設計詳細的IPO結構，包含輸入、處理、輸出的完整規劃。</p>
            <button class="btn btn-sm btn-outline" onclick="platform.switchTab('ipo')">
              設計IPO
            </button>
          </div>
          <div>
            <h3><i class="fas fa-4"></i> 程式生成</h3>
            <p>根據IPO設計生成多語言程式碼（Python/JavaScript/Java/C++）。</p>
            <button class="btn btn-sm btn-outline" onclick="platform.switchTab('code')">
              生成程式碼
            </button>
          </div>
          <div>
            <h3><i class="fas fa-5"></i> 測試驗證</h3>
            <p>進行單元測試和整合測試，確保程式功能符合需求。</p>
            <button class="btn btn-sm btn-outline" onclick="platform.switchTab('test')">
              執行測試
            </button>
          </div>
          <div>
            <h3><i class="fas fa-6"></i> 教學資源</h3>
            <p>生成教學簡報、教材和測驗題目，完整支援教學活動。</p>
            <button class="btn btn-sm btn-outline" onclick="platform.switchTab('teach')">
              生成資源
            </button>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 模型設定頁 -->
    <section id="model" class="content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-brain"></i> AI模型設定</h2>
          <span class="badge badge-info">教學專用優化</span>
        </div>
        
        <div class="model-selector">
          <!-- Grok模型 -->
          <div class="model-card active" data-model="grok">
            <div class="model-icon grok-icon">
              <i class="fas fa-robot"></i>
            </div>
            <div class="model-name">Grok 4.1 Fast</div>
            <div class="model-desc">
              支援推理模式，能展示完整的思考過程，適合教學演示和複雜問題分析。
              透過OpenRouter API訪問，需要API金鑰。
            </div>
            <div class="badge badge-primary">推理模式支援</div>
            <div class="badge badge-warning">需要API金鑰</div>
            <div class="badge badge-info">教學優先</div>
          </div>
          
          <!-- DeepSeek模型 -->
          <div class="model-card" data-model="deepseek">
            <div class="model-icon deepseek-icon">
              <i class="fas fa-bolt"></i>
            </div>
            <div class="model-name">DeepSeek最新模型</div>
            <div class="model-desc">
              免費額度充足，中文支援優秀，API穩定快速。
              適合實際開發和學生練習，提供完整的程式碼生成能力。
            </div>
            <div class="badge badge-success">免費額度</div>
            <div class="badge badge-secondary">中文優化</div>
            <div class="badge badge-info">開發優先</div>
          </div>
          
          <!-- 演示模式 -->
          <div class="model-card" data-model="demo">
            <div class="model-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
              <i class="fas fa-eye"></i>
            </div>
            <div class="model-name">演示模式</div>
            <div class="model-desc">
              無需API金鑰，使用預設模板進行教學演示。
              適合課堂演示或網路不穩定的環境，保證教學流程完整。
            </div>
            <div class="badge badge-warning">無需金鑰</div>
            <div class="badge badge-success">離線可用</div>
            <div class="badge badge-info">教學保證</div>
          </div>
        </div>
        
        <!-- 模型詳細設定 -->
        <div class="form-group">
          <label class="form-label"><i class="fas fa-sliders-h"></i> 模型設定</label>
          
          <div class="reasoning-toggle">
            <input type="checkbox" id="enableReasoning">
            <label for="enableReasoning">
              <i class="fas fa-brain"></i> 啟用推理模式（Grok專用）
            </label>
            <span class="model-desc">展示AI的思考過程，增強教學效果</span>
          </div>
          
          <div class="reasoning-toggle">
            <input type="checkbox" id="enableDetailed" checked>
            <label for="enableDetailed">
              <i class="fas fa-search"></i> 詳細分析模式
            </label>
            <span class="model-desc">生成更詳細的分析內容，適合教學使用</span>
          </div>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-primary" id="applyModel">
            <i class="fas fa-check"></i> 應用選擇
          </button>
          <button class="btn btn-outline" id="testModel">
            <i class="fas fa-vial"></i> 測試模型
          </button>
          <button class="btn btn-outline" id="nextToAnalysis">
            <i class="fas fa-arrow-right"></i> 下一步：AI分析
          </button>
        </div>
        
        <div id="modelStatus"></div>
      </div>
      
      <!-- API金鑰永久儲存設定 -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-key"></i> API金鑰永久儲存</h2>
          <span class="badge badge-success">自動儲存</span>
        </div>
        
        <div class="grid grid-2">
          <div>
            <div class="form-group">
              <label class="form-label"><i class="fas fa-bolt"></i> DeepSeek API 金鑰</label>
              <div class="key-display">
                <div class="key-value" id="modelDeepseekKeyDisplay">
                  未設定
                </div>
                <div class="key-actions">
                  <button class="btn btn-sm btn-outline" id="setDeepseekKey">
                    <i class="fas fa-key"></i> 設定
                  </button>
                </div>
              </div>
              <p class="model-desc">
                前往 <a href="https://platform.deepseek.com/api_keys" target="_blank">DeepSeek平台</a> 取得免費API金鑰
              </p>
            </div>
            
            <div class="form-group">
              <label class="form-label"><i class="fas fa-robot"></i> OpenRouter API 金鑰</label>
              <div class="key-display">
                <div class="key-value" id="modelOpenrouterKeyDisplay">
                  未設定
                </div>
                <div class="key-actions">
                  <button class="btn btn-sm btn-outline" id="setOpenrouterKey">
                    <i class="fas fa-key"></i> 設定
                  </button>
                </div>
              </div>
              <p class="model-desc">
                前往 <a href="https://openrouter.ai/keys" target="_blank">OpenRouter平台</a> 取得API金鑰（用於Grok）
              </p>
            </div>
          </div>
          
          <div>
            <div class="form-group">
              <label class="form-label"><i class="fas fa-info-circle"></i> 金鑰儲存狀態</label>
              <div class="api-response" style="min-height: 150px; font-size: 0.875rem;">
                <div id="storageStatus">
                  <p><i class="fas fa-database"></i> 儲存方式：瀏覽器本地儲存</p>
                  <p><i class="fas fa-shield-alt"></i> 安全性：僅儲存在您的裝置</p>
                  <p><i class="fas fa-sync"></i> 自動同步：即時儲存變更</p>
                  <p><i class="fas fa-history"></i> 備份：支援匯入/匯出</p>
                </div>
              </div>
            </div>
            
            <div class="btn-group">
              <button class="btn btn-outline" id="showKeys">
                <i class="fas fa-eye"></i> 顯示金鑰
              </button>
              <button class="btn btn-outline" id="hideKeys">
                <i class="fas fa-eye-slash"></i> 隱藏金鑰
              </button>
              <button class="btn btn-outline" id="clearModelKeys">
                <i class="fas fa-trash"></i> 清除金鑰
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- AI分析頁 -->
    <section id="api" class="content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-robot"></i> AI互動分析</h2>
          <div id="currentModelBadge" class="badge badge-primary">Grok 4.1 Fast</div>
        </div>
        
        <div class="form-group">
          <label class="form-label"><i class="fas fa-comment-dots"></i> 輸入分析問題</label>
          <textarea id="promptInput" class="form-control" placeholder="請詳細描述您要分析的程式設計問題..." rows="5">
請分析一個學生成績管理系統的IPO結構：
1. 系統需要管理學生基本資料和成績
2. 支援成績輸入、查詢、統計和報表生成
3. 需要考慮資料驗證和錯誤處理
4. 輸出成績單和統計報表
          </textarea>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-primary" id="sendToAI">
            <i class="fas fa-paper-plane"></i> 發送至AI分析
          </button>
          <button class="btn btn-success" id="useTemplate">
            <i class="fas fa-clipboard"></i> 使用模板
          </button>
          <button class="btn btn-outline" id="clearPrompt">
            <i class="fas fa-eraser"></i> 清除輸入
          </button>
          <button class="btn btn-outline" id="examplePrompt">
            <i class="fas fa-lightbulb"></i> 範例問題
          </button>
        </div>
        
        <div class="form-group">
          <label class="form-label"><i class="fas fa-reply"></i> AI分析結果</label>
          <div id="aiResponse" class="api-response">
            等待AI回應...請點擊上方按鈕發送分析請求。
          </div>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-success" id="applyToIPO">
            <i class="fas fa-arrow-right"></i> 下一步：IPO設計
          </button>
          <button class="btn btn-outline" id="saveAnalysis">
            <i class="fas fa-save"></i> 儲存分析
          </button>
          <button class="btn btn-outline" id="exportAnalysis">
            <i class="fas fa-download"></i> 匯出JSON
          </button>
        </div>
        
        <div id="apiStatus"></div>
      </div>
      
      <!-- 分析歷史 -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-history"></i> 分析歷史記錄</h2>
        </div>
        <div id="analysisHistory" class="api-response" style="min-height: 150px;">
          尚無分析記錄
        </div>
      </div>
    </section>
    
    <!-- IPO設計頁 -->
    <section id="ipo" class="content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-sitemap"></i> IPO結構設計</h2>
          <span class="badge badge-success">教學核心</span>
        </div>
        
        <div class="grid grid-3">
          <div class="form-group">
            <label class="form-label"><i class="fas fa-sign-in-alt"></i> Input（輸入）</label>
            <textarea id="ipoInput" class="form-control" placeholder="輸入的資料來源、格式、驗證規則..." rows="10"></textarea>
            <div class="form-label" style="margin-top: 0.5rem;">
              <i class="fas fa-lightbulb"></i> 設計提示
            </div>
            <p class="model-desc">
              考慮：資料來源、輸入格式、驗證規則、錯誤處理機制
            </p>
          </div>
          
          <div class="form-group">
            <label class="form-label"><i class="fas fa-cogs"></i> Process（處理）</label>
            <textarea id="ipoProcess" class="form-control" placeholder="處理步驟、演算法、業務邏輯..." rows="10"></textarea>
            <div class="form-label" style="margin-top: 0.5rem;">
              <i class="fas fa-lightbulb"></i> 設計提示
            </div>
            <p class="model-desc">
              考慮：處理步驟、核心演算法、業務邏輯、效能優化
            </p>
          </div>
          
          <div class="form-group">
            <label class="form-label"><i class="fas fa-sign-out-alt"></i> Output（輸出）</label>
            <textarea id="ipoOutput" class="form-control" placeholder="輸出格式、呈現方式、報告內容..." rows="10"></textarea>
            <div class="form-label" style="margin-top: 0.5rem;">
              <i class="fas fa-lightbulb"></i> 設計提示
            </div>
            <p class="model-desc">
              考慮：輸出格式、呈現方式、錯誤輸出、擴充輸出
            </p>
          </div>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-success" id="saveIPO">
            <i class="fas fa-save"></i> 儲存IPO設計
          </button>
          <button class="btn btn-primary" id="generateFromIPO">
            <i class="fas fa-arrow-right"></i> 下一步：程式生成
          </button>
          <button class="btn btn-secondary" id="validateIPO">
            <i class="fas fa-check-double"></i> 驗證完整性
          </button>
          <button class="btn btn-outline" id="clearIPO">
            <i class="fas fa-trash"></i> 清除內容
          </button>
        </div>
        
        <div id="ipoStatus"></div>
      </div>
      
      <!-- IPO視覺化 -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-project-diagram"></i> IPO流程視覺化</h2>
        </div>
        <div id="ipoVisualization" class="api-response" style="min-height: 200px; text-align: center; padding: 2rem;">
          <div style="display: inline-block; text-align: left;">
            <div style="background: var(--primary); color: white; padding: 1rem 2rem; border-radius: var(--radius-md); margin-bottom: 1rem; display: inline-block;">
              <i class="fas fa-sign-in-alt"></i> Input
            </div>
            <div style="margin: 1rem 0; text-align: center;">
              <i class="fas fa-arrow-right" style="font-size: 1.5rem; color: var(--primary);"></i>
            </div>
            <div style="background: var(--secondary); color: white; padding: 1rem 2rem; border-radius: var(--radius-md); margin-bottom: 1rem; display: inline-block;">
              <i class="fas fa-cogs"></i> Process
            </div>
            <div style="margin: 1rem 0; text-align: center;">
              <i class="fas fa-arrow-right" style="font-size: 1.5rem; color: var(--secondary);"></i>
            </div>
            <div style="background: var(--success); color: white; padding: 1rem 2rem; border-radius: var(--radius-md); display: inline-block;">
              <i class="fas fa-sign-out-alt"></i> Output
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 程式生成頁 -->
    <section id="code" class="content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-code"></i> 程式碼生成</h2>
          <span class="badge badge-secondary">多語言支援</span>
        </div>
        
        <!-- 語言選擇 -->
        <div class="form-group">
          <label class="form-label"><i class="fas fa-globe"></i> 選擇程式語言</label>
          <div class="btn-group">
            <button class="btn btn-outline active" data-lang="python">
              <i class="fab fa-python"></i> Python
            </button>
            <button class="btn btn-outline" data-lang="javascript">
              <i class="fab fa-js"></i> JavaScript
            </button>
            <button class="btn btn-outline" data-lang="java">
              <i class="fab fa-java"></i> Java
            </button>
            <button class="btn btn-outline" data-lang="cpp">
              <i class="fas fa-cog"></i> C++
            </button>
          </div>
        </div>
        
        <!-- 程式碼輸出 -->
        <div class="form-group">
          <label class="form-label"><i class="fas fa-file-code"></i> 生成的程式碼</label>
          <textarea id="codeOutput" class="form-control" rows="20" placeholder="生成的程式碼將顯示在這裡..." readonly></textarea>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-primary" id="generateCode">
            <i class="fas fa-magic"></i> 生成程式碼
          </button>
          <button class="btn btn-success" id="copyCode">
            <i class="fas fa-copy"></i> 複製程式碼
          </button>
          <button class="btn btn-outline" id="downloadCode">
            <i class="fas fa-download"></i> 下載檔案
          </button>
          <button class="btn btn-outline" id="formatCode">
            <i class="fas fa-indent"></i> 格式化程式碼
          </button>
          <button class="btn btn-primary" id="nextToTeach">
            <i class="fas fa-arrow-right"></i> 下一步：教學資源
          </button>
        </div>
        
        <div id="codeStatus"></div>
      </div>
    </section>
    
    <!-- 教學資源頁 -->
    <section id="teach" class="content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-chalkboard-teacher"></i> 教學資源生成</h2>
          <span class="badge badge-success">完整教學套件</span>
        </div>
        
        <!-- 資源類型選擇 -->
        <div class="form-group">
          <label class="form-label"><i class="fas fa-cube"></i> 選擇教學資源類型</label>
          <div class="templates-grid">
            <div class="template-card" data-resource="slides">
              <div class="template-icon"><i class="fas fa-slideshow"></i></div>
              <div class="template-title">教學簡報</div>
              <div class="template-desc">生成完整的教學簡報大綱，包含教學目標、內容和活動設計</div>
            </div>
            <div class="template-card" data-resource="lessonplan">
              <div class="template-icon"><i class="fas fa-book"></i></div>
              <div class="template-title">教案設計</div>
              <div class="template-desc">詳細的課程教案，包含時間分配、教學方法和評估方式</div>
            </div>
            <div class="template-card" data-resource="worksheet">
              <div class="template-icon"><i class="fas fa-file-alt"></i></div>
              <div class="template-title">學習單</div>
              <div class="template-desc">學生使用的練習和作業，包含填空、選擇和實作題</div>
            </div>
            <div class="template-card" data-resource="assessment">
              <div class="template-icon"><i class="fas fa-clipboard-check"></i></div>
              <div class="template-title">測驗題庫</div>
              <div class="template-desc">生成選擇題、簡答題和實作題，包含評分標準</div>
            </div>
            <div class="template-card" data-resource="project">
              <div class="template-icon"><i class="fas fa-project-diagram"></i></div>
              <div class="template-title">專案作業</div>
              <div class="template-desc">完整的課程專案說明，包含需求分析、評分標準和提交要求</div>
            </div>
            <div class="template-card" data-resource="video">
              <div class="template-icon"><i class="fas fa-video"></i></div>
              <div class="template-title">教學影片腳本</div>
              <div class="template-desc">生成教學影片的分鏡腳本，包含旁白和畫面說明</div>
            </div>
          </div>
        </div>
        
        <!-- 資源內容 -->
        <div class="form-group">
          <label class="form-label"><i class="fas fa-file-contract"></i> 教學資源內容</label>
          <textarea id="teachingContent" class="form-control" rows="20" placeholder="選擇教學資源類型後，內容將顯示在這裡..."></textarea>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-primary" id="generateResource">
            <i class="fas fa-scroll"></i> 生成教學資源
          </button>
          <button class="btn btn-success" id="exportResource">
            <i class="fas fa-file-export"></i> 匯出為Word
          </button>
          <button class="btn btn-outline" id="printResource">
            <i class="fas fa-print"></i> 列印資源
          </button>
          <button class="btn btn-outline" id="completeProcess">
            <i class="fas fa-flag-checkered"></i> 完成流程
          </button>
        </div>
        
        <div id="teachStatus"></div>
      </div>
    </section>
    
    <!-- 系統測試頁 -->
    <section id="test" class="content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-vial"></i> 系統測試套件</h2>
          <span class="badge badge-danger">品質保證</span>
        </div>
        
        <!-- 測試結果顯示 -->
        <div class="test-results">
          <div class="test-card">
            <div class="test-icon" style="color: var(--success)">
              <i class="fas fa-plug"></i>
            </div>
            <div class="test-label">API連線</div>
            <div class="test-value" id="testApi">待測試</div>
          </div>
          <div class="test-card">
            <div class="test-icon" style="color: var(--primary)">
              <i class="fas fa-code"></i>
            </div>
            <div class="test-label">程式碼生成</div>
            <div class="test-value" id="testCode">待測試</div>
          </div>
          <div class="test-card">
            <div class="test-icon" style="color: var(--secondary)">
              <i class="fas fa-sitemap"></i>
            </div>
            <div class="test-label">IPO分析</div>
            <div class="test-value" id="testIpo">待測試</div>
          </div>
          <div class="test-card">
            <div class="test-icon" style="color: var(--info)">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="test-label">教學資源</div>
            <div class="test-value" id="testTeach">待測試</div>
          </div>
        </div>
        
        <!-- 測試按鈕 -->
        <div class="toolbar">
          <button class="btn btn-primary" id="runAllTests">
            <i class="fas fa-play-circle"></i> 執行完整測試
          </button>
          <button class="btn btn-success" id="testApiOnly">
            <i class="fas fa-network-wired"></i> API連線測試
          </button>
          <button class="btn btn-outline" id="testStorage">
            <i class="fas fa-database"></i> 儲存系統測試
          </button>
        </div>
        
        <!-- 測試日誌 -->
        <div class="form-group">
          <label class="form-label"><i class="fas fa-clipboard-list"></i> 測試日誌</label>
          <div id="testLog" class="api-response" style="min-height: 300px;">
            測試日誌將顯示在這裡...
          </div>
        </div>
        
        <div class="toolbar">
          <button class="btn btn-outline" id="exportReport">
            <i class="fas fa-file-export"></i> 匯出測試報告
          </button>
          <button class="btn btn-outline" id="clearLogs">
            <i class="fas fa-trash"></i> 清除日誌
          </button>
          <button class="btn btn-outline" id="backToHome">
            <i class="fas fa-home"></i> 返回首頁
          </button>
        </div>
      </div>
    </section>
  </div>

  <!-- API金鑰設定模態窗 -->
  <div id="apiKeyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-key"></i> API金鑰設定</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div id="modalContent">
        <!-- 動態內容 -->
      </div>
    </div>
  </div>

  <script>
    // AI教學平台主類別 - 修正版
    class AIEducationPlatform {
      constructor() {
        // 平台狀態
        this.state = {
          currentModel: 'grok',
          currentTab: 'home',
          apiKeys: {
            deepseek: '',
            openrouter: ''
          },
          enableReasoning: true,
          enableDetailed: true,
          isDemoMode: false,
          isInitialized: false,
          testResults: {},
          analysisHistory: [],
          projectData: {},
          progress: {
            model: false,
            analysis: false,
            ipo: false,
            code: false,
            teach: false
          }
        };
        
        // 模型設定
        this.models = {
          grok: {
            name: 'Grok 4.1 Fast',
            provider: 'OpenRouter',
            endpoint: 'https://openrouter.ai/api/v1/chat/completions',
            requiresKey: true,
            supportsReasoning: true,
            description: '適合教學演示，支援推理模式',
            icon: 'fa-robot',
            color: 'primary',
            maxTokens: 4000
          },
          deepseek: {
            name: 'DeepSeek最新模型',
            provider: 'DeepSeek',
            endpoint: 'https://api.deepseek.com/v1/chat/completions',
            requiresKey: true,
            supportsReasoning: false,
            description: '免費額度充足，中文支援優秀',
            icon: 'fa-bolt',
            color: 'info',
            maxTokens: 4000
          },
          demo: {
            name: '演示模式',
            provider: '本地',
            endpoint: null,
            requiresKey: false,
            supportsReasoning: false,
            description: '無需API金鑰，使用預設模板',
            icon: 'fa-eye',
            color: 'warning',
            maxTokens: 2000
          }
        };
        
        // 教學模板
        this.templates = {
          calculator: {
            name: '計算器程式',
            problem: '設計一個計算器程式，支援加減乘除四則運算，包含錯誤處理和歷史記錄功能。',
            difficulty: '初級',
            estimatedTime: '1小時',
            learningPoints: ['基礎IPO分析', '錯誤處理', '函數設計']
          },
          student: {
            name: '學生成績系統',
            problem: '設計一個學生成績管理系統，支援成績輸入、查詢、統計和報表生成。',
            difficulty: '中級',
            estimatedTime: '2小時',
            learningPoints: ['資料結構設計', '檔案處理', '報表生成']
          },
          quiz: {
            name: '測驗系統',
            problem: '設計一個線上測驗系統，包含題庫管理、隨機出題、自動評分和成績統計。',
            difficulty: '高級',
            estimatedTime: '3小時',
            learningPoints: ['演算法設計', '使用者介面', '資料庫操作']
          }
        };
        
        // 初始化
        this.init();
      }
      
      // 初始化平台
      init() {
        this.loadState();
        this.bindEvents();
        this.updateUI();
        this.state.isInitialized = true;
        
        this.showStatus('🎉 AI教學平台初始化完成！', 'homeStatus', 'success');
        console.log('🚀 AI教學平台已啟動');
        console.log('📊 當前狀態:', this.state);
      }
      
      // 加強版的狀態載入 - 支援API金鑰永久儲存
      loadState() {
        try {
          // 嘗試從多個來源載入狀態
          const savedState = localStorage.getItem('ai_teaching_platform_state');
          const savedKeys = localStorage.getItem('ai_teaching_platform_keys');
          const savedProgress = localStorage.getItem('ai_teaching_platform_progress');
          
          if (savedState) {
            const parsed = JSON.parse(savedState);
            // 合併狀態，但保留重要的預設值
            this.state = { 
              ...this.state, 
              ...parsed,
              apiKeys: this.state.apiKeys // 保留原始apiKeys，避免載入錯誤格式
            };
          }
          
          // 獨立載入API金鑰（確保永久儲存）
          if (savedKeys) {
            try {
              const keys = JSON.parse(savedKeys);
              this.state.apiKeys = { ...this.state.apiKeys, ...keys };
            } catch (e) {
              console.warn('API金鑰載入失敗，使用預設值');
            }
          }
          
          // 載入進度
          if (savedProgress) {
            try {
              this.state.progress = JSON.parse(savedProgress);
            } catch (e) {
              console.warn('進度載入失敗，使用預設值');
            }
          }
          
          // 驗證和清理API金鑰
          this.validateAndCleanKeys();
          
        } catch (error) {
          console.error('載入狀態失敗:', error);
          // 創建備份
          this.createBackup();
        }
      }
      
      // 驗證和清理API金鑰
      validateAndCleanKeys() {
        Object.keys(this.state.apiKeys).forEach(key => {
          if (this.state.apiKeys[key]) {
            // 移除可能的空白字元
            this.state.apiKeys[key] = this.state.apiKeys[key].trim();
            // 驗證基本格式
            if (!this.state.apiKeys[key].startsWith('sk-')) {
              console.warn(`API金鑰 ${key} 格式可能不正確`);
            }
          }
        });
      }
      
      // 加強版的狀態儲存 - 支援API金鑰永久儲存
      saveState() {
        try {
          // 分別儲存不同類型的資料
          const stateToSave = {
            currentModel: this.state.currentModel,
            currentTab: this.state.currentTab,
            enableReasoning: this.state.enableReasoning,
            enableDetailed: this.state.enableDetailed,
            isDemoMode: this.state.isDemoMode,
            isInitialized: this.state.isInitialized,
            analysisHistory: this.state.analysisHistory,
            projectData: this.state.projectData
          };
          
          localStorage.setItem('ai_teaching_platform_state', JSON.stringify(stateToSave));
          
          // 獨立儲存API金鑰（確保永久性）
          localStorage.setItem('ai_teaching_platform_keys', JSON.stringify(this.state.apiKeys));
          
          // 儲存進度
          localStorage.setItem('ai_teaching_platform_progress', JSON.stringify(this.state.progress));
          
          // 創建時間戳記備份
          this.createTimestampBackup();
          
          console.log('💾 平台狀態已儲存');
          
        } catch (error) {
          console.error('儲存狀態失敗:', error);
          // 嘗試使用備份機制
          this.saveToBackupStorage();
        }
      }
      
      // 創建時間戳記備份
      createTimestampBackup() {
        try {
          const timestamp = new Date().toISOString();
          const backupKey = `ai_teaching_backup_${timestamp}`;
          const backupData = {
            state: this.state,
            timestamp: timestamp
          };
          
          // 只保留最近的5個備份
          this.cleanOldBackups();
          
          localStorage.setItem(backupKey, JSON.stringify(backupData));
        } catch (error) {
          console.warn('創建時間戳記備份失敗:', error);
        }
      }
      
      // 清理舊備份
      cleanOldBackups() {
        try {
          const backups = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('ai_teaching_backup_')) {
              backups.push(key);
            }
          }
          
          // 按時間排序，保留最新的5個
          backups.sort();
          if (backups.length > 5) {
            for (let i = 0; i < backups.length - 5; i++) {
              localStorage.removeItem(backups[i]);
            }
          }
        } catch (error) {
          console.warn('清理舊備份失敗:', error);
        }
      }
      
      // 備份儲存機制
      saveToBackupStorage() {
        try {
          // 嘗試使用sessionStorage作為備份
          sessionStorage.setItem('ai_teaching_backup', JSON.stringify(this.state));
          
          // 嘗試使用IndexedDB
          if ('indexedDB' in window) {
            this.saveToIndexedDB();
          }
        } catch (error) {
          console.error('備份儲存失敗:', error);
        }
      }
      
      // 綁定事件
      bindEvents() {
        // 導航按鈕
        document.querySelectorAll('.nav-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const tab = e.currentTarget.dataset.tab;
            this.switchTab(tab);
          });
        });
        
        // 流程指示器點擊
        document.querySelectorAll('.process-step').forEach(step => {
          step.addEventListener('click', (e) => {
            const tab = e.currentTarget.dataset.tab;
            if (tab) {
              this.switchTab(tab);
            }
          });
        });
        
        // 模型選擇
        document.querySelectorAll('.model-card').forEach(card => {
          card.addEventListener('click', (e) => {
            const model = e.currentTarget.dataset.model;
            this.selectModel(model);
          });
        });
        
        // 教學模板
        document.querySelectorAll('.template-card').forEach(card => {
          card.addEventListener('click', (e) => {
            const template = e.currentTarget.dataset.template;
            if (template) this.loadTemplate(template);
          });
        });
        
        // 快速操作按鈕
        document.getElementById('quickStart').addEventListener('click', () => this.quickStart());
        document.getElementById('demoMode').addEventListener('click', () => this.enableDemoMode());
        document.getElementById('resetProgress').addEventListener('click', () => this.resetProgress());
        
        // API金鑰管理
        document.getElementById('quickSetup').addEventListener('click', () => this.quickSetup());
        document.getElementById('exportKeys').addEventListener('click', () => this.exportKeys());
        document.getElementById('importKeys').addEventListener('click', () => this.importKeys());
        document.getElementById('clearLocalData').addEventListener('click', () => this.clearLocalData());
        document.getElementById('backupData').addEventListener('click', () => this.backupData());
        
        // API金鑰操作
        document.getElementById('editDeepseekKey').addEventListener('click', () => this.setupAPI('deepseek'));
        document.getElementById('testDeepseekKey').addEventListener('click', () => this.testAPIKey('deepseek'));
        document.getElementById('editOpenrouterKey').addEventListener('click', () => this.setupAPI('openrouter'));
        document.getElementById('testOpenrouterKey').addEventListener('click', () => this.testAPIKey('openrouter'));
        
        // 模型頁API金鑰
        document.getElementById('setDeepseekKey').addEventListener('click', () => this.setupAPI('deepseek'));
        document.getElementById('setOpenrouterKey').addEventListener('click', () => this.setupAPI('openrouter'));
        document.getElementById('showKeys').addEventListener('click', () => this.showKeys());
        document.getElementById('hideKeys').addEventListener('click', () => this.hideKeys());
        document.getElementById('clearModelKeys').addEventListener('click', () => this.clearModelKeys());
        
        // 模型設定頁
        document.getElementById('applyModel').addEventListener('click', () => this.applyModel());
        document.getElementById('testModel').addEventListener('click', () => this.testCurrentModel());
        document.getElementById('nextToAnalysis').addEventListener('click', () => this.switchTab('api'));
        
        // AI分析頁
        document.getElementById('sendToAI').addEventListener('click', () => this.analyzeWithAI());
        document.getElementById('useTemplate').addEventListener('click', () => this.useTemplatePrompt());
        document.getElementById('applyToIPO').addEventListener('click', () => this.applyToIPOAndNext());
        
        // IPO設計頁
        document.getElementById('saveIPO').addEventListener('click', () => this.saveIPOAnalysis());
        document.getElementById('generateFromIPO').addEventListener('click', () => this.generateCodeFromIPO());
        document.getElementById('validateIPO').addEventListener('click', () => this.validateIPO());
        
        // 程式碼生成頁
        document.getElementById('generateCode').addEventListener('click', () => this.generateCode());
        document.getElementById('copyCode').addEventListener('click', () => this.copyCodeToClipboard());
        document.getElementById('downloadCode').addEventListener('click', () => this.downloadCode());
        document.getElementById('nextToTeach').addEventListener('click', () => this.switchTab('teach'));
        
        // 教學資源頁
        document.getElementById('generateResource').addEventListener('click', () => this.generateTeachingResource());
        document.getElementById('exportResource').addEventListener('click', () => this.exportResource());
        document.getElementById('completeProcess').addEventListener('click', () => this.completeProcess());
        
        // 系統測試頁
        document.getElementById('runAllTests').addEventListener('click', () => this.runAllTests());
        document.getElementById('testApiOnly').addEventListener('click', () => this.testAPI());
        document.getElementById('testStorage').addEventListener('click', () => this.testStorage());
        document.getElementById('backToHome').addEventListener('click', () => this.switchTab('home'));
        
        // 模態窗關閉
        document.getElementById('closeModal').addEventListener('click', () => this.hideModal('apiKeyModal'));
        
        // 模態窗背景點擊關閉
        document.querySelectorAll('.modal').forEach(modal => {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.classList.remove('active');
            }
          });
        });
        
        // 表單變更監聽
        document.getElementById('enableReasoning').addEventListener('change', (e) => {
          this.state.enableReasoning = e.target.checked;
          this.saveState();
        });
        
        document.getElementById('enableDetailed').addEventListener('change', (e) => {
          this.state.enableDetailed = e.target.checked;
          this.saveState();
        });
        
        // 程式語言選擇
        document.querySelectorAll('[data-lang]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const lang = e.currentTarget.dataset.lang;
            this.selectLanguage(lang);
          });
        });
        
        // 教學資源選擇
        document.querySelectorAll('[data-resource]').forEach(card => {
          card.addEventListener('click', (e) => {
            const resource = e.currentTarget.dataset.resource;
            this.selectResourceType(resource);
          });
        });
        
        // 鍵盤快捷鍵
        document.addEventListener('keydown', (e) => {
          if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
              case '1': e.preventDefault(); this.switchTab('home'); break;
              case '2': e.preventDefault(); this.switchTab('model'); break;
              case '3': e.preventDefault(); this.switchTab('api'); break;
              case '4': e.preventDefault(); this.switchTab('ipo'); break;
              case '5': e.preventDefault(); this.switchTab('code'); break;
              case '6': e.preventDefault(); this.switchTab('teach'); break;
              case '7': e.preventDefault(); this.switchTab('test'); break;
              case 's': e.preventDefault(); this.saveCurrentState(); break;
              case 'r': e.preventDefault(); this.resetPlatform(); break;
            }
          }
        });
        
        // 頁面卸載前儲存
        window.addEventListener('beforeunload', () => {
          this.saveState();
        });
        
        // 定期自動儲存
        setInterval(() => {
          this.saveState();
        }, 30000); // 每30秒自動儲存
      }
      
      // 切換頁籤（修正流程順序）
      switchTab(tabId) {
        // 更新導航按鈕
        document.querySelectorAll('.nav-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.tab === tabId) {
            btn.classList.add('active');
          }
        });
        
        // 更新內容顯示
        document.querySelectorAll('.content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');
        
        // 更新狀態
        this.state.currentTab = tabId;
        
        // 更新流程指示器
        this.updateProcessFlow(tabId);
        
        // 更新進度
        this.updateProgress(tabId);
        
        // 儲存狀態
        this.saveState();
        
        // 觸發頁面特定初始化
        this.onTabSwitch(tabId);
      }
      
      // 更新流程指示器
      updateProcessFlow(tabId) {
        const steps = document.querySelectorAll('.process-step');
        const tabOrder = ['home', 'model', 'api', 'ipo', 'code', 'teach', 'test'];
        const stepIndex = tabOrder.indexOf(tabId);
        
        steps.forEach((step, index) => {
          step.classList.remove('active');
          if (tabOrder[index] && this.state.progress[tabOrder[index]]) {
            step.classList.add('completed');
          } else {
            step.classList.remove('completed');
          }
          if (index === stepIndex) {
            step.classList.add('active');
          }
        });
      }
      
      // 更新進度
      updateProgress(tabId) {
        const progressMap = {
          'model': 'model',
          'api': 'analysis',
          'ipo': 'ipo',
          'code': 'code',
          'teach': 'teach'
        };
        
        if (progressMap[tabId] && !this.state.progress[progressMap[tabId]]) {
          this.state.progress[progressMap[tabId]] = true;
          this.updateProgressDisplay();
          this.saveState();
        }
      }
      
      // 更新進度顯示
      updateProgressDisplay() {
        const totalSteps = 5; // model, analysis, ipo, code, teach
        const completedSteps = Object.values(this.state.progress).filter(v => v).length;
        const progressPercent = Math.round((completedSteps / totalSteps) * 100);
        
        document.getElementById('statusProgress').textContent = `${progressPercent}%`;
        
        // 更新進度條視覺化
        const steps = document.querySelectorAll('.process-step');
        steps.forEach((step, index) => {
          const stepId = step.dataset.tab;
          if (this.state.progress[stepId]) {
            step.classList.add('completed');
            step.querySelector('.step-number').innerHTML = '<i class="fas fa-check"></i>';
          }
        });
      }
      
      // 頁面切換時的初始化
      onTabSwitch(tabId) {
        switch(tabId) {
          case 'home':
            this.updateSystemStatus();
            this.updateKeyDisplays();
            break;
          case 'model':
            this.updateModelStatus();
            this.updateKeyDisplays();
            break;
          case 'api':
            this.loadAnalysisHistory();
            break;
          case 'ipo':
            this.updateIPOValidation();
            break;
          case 'code':
            this.updateCodePreview();
            break;
          case 'test':
            this.updateTestResults();
            break;
        }
      }
      
      // 選擇模型
      selectModel(modelId) {
        if (!this.models[modelId]) return;
        
        this.state.currentModel = modelId;
        
        // 更新UI
        document.querySelectorAll('.model-card').forEach(card => {
          card.classList.remove('active');
        });
        document.querySelector(`[data-model="${modelId}"]`).classList.add('active');
        
        // 更新模型狀態
        this.updateModelStatus();
        this.saveState();
        
        this.showStatus(`✅ 已選擇 ${this.models[modelId].name}`, 'modelStatus', 'success');
      }
      
      // 應用模型設定
      applyModel() {
        this.state.progress.model = true;
        this.updateProgressDisplay();
        this.saveState();
        this.showStatus('✅ 模型設定已應用', 'modelStatus', 'success');
      }
      
      // 更新模型狀態
      updateModelStatus() {
        const model = this.models[this.state.currentModel];
        
        // 更新狀態顯示
        document.getElementById('statusModel').textContent = model.name;
        document.getElementById('currentModelBadge').textContent = model.name;
        document.getElementById('currentModelBadge').className = `badge badge-${model.color}`;
        
        // 更新推理模式開關
        const reasoningToggle = document.getElementById('enableReasoning');
        reasoningToggle.disabled = !model.supportsReasoning;
        reasoningToggle.checked = model.supportsReasoning && this.state.enableReasoning;
        
        if (!model.supportsReasoning) {
          this.showStatus('⚠️ 當前模型不支援推理模式', 'modelStatus', 'warning');
        }
        
        // 更新API金鑰狀態
        this.updateKeyDisplays();
      }
      
      // 更新金鑰顯示
      updateKeyDisplays() {
        // 首頁顯示
        const deepseekKey = this.state.apiKeys.deepseek;
        const openrouterKey = this.state.apiKeys.openrouter;
        
        document.getElementById('deepseekKeyDisplay').textContent = 
          `DeepSeek: ${deepseekKey ? '已設定' : '未設定'}`;
        document.getElementById('openrouterKeyDisplay').textContent = 
          `OpenRouter: ${openrouterKey ? '已設定' : '未設定'}`;
        
        document.getElementById('deepseekKeyDisplay').style.color = 
          deepseekKey ? 'var(--success)' : 'var(--danger)';
        document.getElementById('openrouterKeyDisplay').style.color = 
          openrouterKey ? 'var(--success)' : 'var(--danger)';
        
        // 模型頁顯示
        document.getElementById('modelDeepseekKeyDisplay').textContent = 
          deepseekKey ? this.maskKey(deepseekKey) : '未設定';
        document.getElementById('modelOpenrouterKeyDisplay').textContent = 
          openrouterKey ? this.maskKey(openrouterKey) : '未設定';
        
        document.getElementById('modelDeepseekKeyDisplay').style.color = 
          deepseekKey ? 'var(--success)' : 'var(--danger)';
        document.getElementById('modelOpenrouterKeyDisplay').style.color = 
          openrouterKey ? 'var(--success)' : 'var(--danger)';
        
        // 更新API金鑰狀態
        const hasKey = deepseekKey || openrouterKey;
        document.getElementById('statusApiKey').textContent = hasKey ? '已設定' : '未設定';
        document.getElementById('statusApiKey').style.color = hasKey ? 
          'var(--success)' : 'var(--danger)';
      }
      
      // 遮蔽金鑰顯示
      maskKey(key) {
        if (!key) return '未設定';
        if (key.length <= 8) return key;
        return key.substring(0, 4) + '...' + key.substring(key.length - 4);
      }
      
      // 顯示完整金鑰
      showKeys() {
        document.getElementById('modelDeepseekKeyDisplay').textContent = 
          this.state.apiKeys.deepseek || '未設定';
        document.getElementById('modelOpenrouterKeyDisplay').textContent = 
          this.state.apiKeys.openrouter || '未設定';
      }
      
      // 隱藏金鑰
      hideKeys() {
        this.updateKeyDisplays();
      }
      
      // 清除模型頁金鑰
      clearModelKeys() {
        if (confirm('確定要清除所有API金鑰嗎？')) {
          this.state.apiKeys.deepseek = '';
          this.state.apiKeys.openrouter = '';
          this.saveState();
          this.updateKeyDisplays();
          this.showStatus('✅ API金鑰已清除', 'modelStatus', 'success');
        }
      }
      
      // 設定API金鑰
      setupAPI(provider) {
        const modal = document.getElementById('apiKeyModal');
        const content = document.getElementById('modalContent');
        
        const providers = {
          deepseek: {
            name: 'DeepSeek',
            guideUrl: 'https://platform.deepseek.com/api_keys',
            placeholder: '輸入DeepSeek API金鑰（以sk-開頭）',
            currentKey: this.state.apiKeys.deepseek
          },
          openrouter: {
            name: 'OpenRouter (Grok)',
            guideUrl: 'https://openrouter.ai/keys',
            placeholder: '輸入OpenRouter API金鑰（以sk-or-開頭）',
            currentKey: this.state.apiKeys.openrouter
          }
        };
        
        const providerInfo = providers[provider];
        if (!providerInfo) return;
        
        content.innerHTML = `
          <div class="form-group">
            <label class="form-label"><i class="fas fa-key"></i> ${providerInfo.name} API金鑰</label>
            <input type="password" id="apiKeyInput" class="form-control" 
                   value="${providerInfo.currentKey || ''}"
                   placeholder="${providerInfo.placeholder}">
            
            <div class="btn-group" style="margin-top: 1rem;">
              <button class="btn btn-outline" id="toggleKeyVisibility">
                <i class="fas fa-eye"></i> 顯示/隱藏
              </button>
              <button class="btn btn-outline" id="showGuide">
                <i class="fas fa-external-link-alt"></i> 如何取得？
              </button>
            </div>
            
            <div id="keyValidation" style="margin-top: 1rem; display: none;">
              <div class="status status-info">
                <i class="fas fa-spinner fa-spin"></i> 驗證中...
              </div>
            </div>
          </div>
          
          <div class="toolbar">
            <button class="btn btn-outline" id="cancelKey">
              <i class="fas fa-times"></i> 取消
            </button>
            <button class="btn btn-primary" id="saveKey">
              <i class="fas fa-save"></i> 儲存金鑰
            </button>
            <button class="btn btn-success" id="testKey">
              <i class="fas fa-vial"></i> 測試金鑰
            </button>
          </div>
          
          <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md);">
            <p class="model-desc">
              <i class="fas fa-info-circle"></i> 金鑰將永久儲存在您的瀏覽器中，僅供本平台使用。
            </p>
          </div>
        `;
        
        modal.classList.add('active');
        
        // 綁定模態窗內事件
        setTimeout(() => {
          const keyInput = document.getElementById('apiKeyInput');
          const toggleBtn = document.getElementById('toggleKeyVisibility');
          const saveBtn = document.getElementById('saveKey');
          const testBtn = document.getElementById('testKey');
          
          // 切換金鑰可見性
          toggleBtn.addEventListener('click', () => {
            const type = keyInput.type === 'password' ? 'text' : 'password';
            keyInput.type = type;
            toggleBtn.innerHTML = type === 'password' ? 
              '<i class="fas fa-eye"></i> 顯示' : 
              '<i class="fas fa-eye-slash"></i> 隱藏';
          });
          
          document.getElementById('showGuide').addEventListener('click', () => {
            window.open(providerInfo.guideUrl, '_blank');
          });
          
          document.getElementById('cancelKey').addEventListener('click', () => {
            modal.classList.remove('active');
          });
          
          // 儲存金鑰
          saveBtn.addEventListener('click', () => {
            const key = keyInput.value.trim();
            if (key) {
              // 基本驗證
              if (provider === 'deepseek' && !key.startsWith('sk-')) {
                alert('DeepSeek API金鑰應以 "sk-" 開頭');
                return;
              }
              
              if (provider === 'openrouter' && !key.startsWith('sk-or-')) {
                alert('OpenRouter API金鑰應以 "sk-or-" 開頭');
                return;
              }
              
              // 儲存金鑰
              if (provider === 'deepseek') {
                this.state.apiKeys.deepseek = key;
              } else {
                this.state.apiKeys.openrouter = key;
              }
              
              // 永久儲存
              this.saveState();
              
              // 更新顯示
              this.updateKeyDisplays();
              
              this.showStatus(`✅ ${providerInfo.name} API金鑰已儲存`, 'homeStatus', 'success');
              modal.classList.remove('active');
              
              // 自動測試金鑰
              setTimeout(() => {
                this.testAPIKey(provider);
              }, 500);
              
            } else {
              alert('請輸入有效的API金鑰');
            }
          });
          
          // 測試金鑰
          testBtn.addEventListener('click', async () => {
            const key = keyInput.value.trim();
            if (!key) {
              alert('請先輸入API金鑰');
              return;
            }
            
            const validationArea = document.getElementById('keyValidation');
            validationArea.style.display = 'block';
            validationArea.innerHTML = '<div class="status status-info"><i class="fas fa-spinner fa-spin"></i> 測試中...</div>';
            
            try {
              const result = await this.testAPIKeyDirect(provider, key);
              if (result.success) {
                validationArea.innerHTML = `<div class="status status-success"><i class="fas fa-check"></i> ${providerInfo.name} API金鑰測試成功！</div>`;
              } else {
                validationArea.innerHTML = `<div class="status status-error"><i class="fas fa-times"></i> 測試失敗: ${result.message}</div>`;
              }
            } catch (error) {
              validationArea.innerHTML = `<div class="status status-error"><i class="fas fa-times"></i> 測試錯誤: ${error.message}</div>`;
            }
          });
          
          // 輸入時自動驗證格式
          keyInput.addEventListener('input', () => {
            const key = keyInput.value.trim();
            if (key) {
              if (provider === 'deepseek' && !key.startsWith('sk-')) {
                keyInput.style.borderColor = 'var(--danger)';
              } else if (provider === 'openrouter' && !key.startsWith('sk-or-')) {
                keyInput.style.borderColor = 'var(--danger)';
              } else {
                keyInput.style.borderColor = 'var(--success)';
              }
            }
          });
        }, 100);
      }
      
      // 直接測試API金鑰
      async testAPIKeyDirect(provider, key) {
        try {
          let url, headers;
          
          if (provider === 'deepseek') {
            url = 'https://api.deepseek.com/v1/models';
            headers = {
              'Authorization': `Bearer ${key}`,
              'Content-Type': 'application/json'
            };
          } else {
            url = 'https://openrouter.ai/api/v1/models';
            headers = {
              'Authorization': `Bearer ${key}`,
              'Content-Type': 'application/json'
            };
          }
          
          const response = await fetch(url, { headers });
          
          if (response.ok) {
            return { success: true, message: '金鑰有效' };
          } else {
            return { 
              success: false, 
              message: `HTTP ${response.status}: ${response.statusText}` 
            };
          }
        } catch (error) {
          return { 
            success: false, 
            message: `網路錯誤: ${error.message}` 
          };
        }
      }
      
      // 測試API金鑰（使用已儲存的金鑰）
      async testAPIKey(provider) {
        const key = provider === 'deepseek' ? 
          this.state.apiKeys.deepseek : this.state.apiKeys.openrouter;
        
        if (!key) {
          this.showStatus(`請先設定${provider} API金鑰`, 'homeStatus', 'warning');
          return;
        }
        
        this.showStatus(`測試${provider} API金鑰中...`, 'homeStatus', 'info');
        
        try {
          const result = await this.testAPIKeyDirect(provider, key);
          if (result.success) {
            this.showStatus(`✅ ${provider} API金鑰測試成功`, 'homeStatus', 'success');
          } else {
            this.showStatus(`❌ ${provider} API金鑰測試失敗: ${result.message}`, 'homeStatus', 'error');
          }
        } catch (error) {
          this.showStatus(`❌ ${provider} API金鑰測試錯誤: ${error.message}`, 'homeStatus', 'error');
        }
      }
      
      // 隱藏模態窗
      hideModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
      }
      
      // 快速設定
      quickSetup() {
        // 引導使用者完成基本設定
        this.showStatus('🚀 開始快速設定...', 'homeStatus', 'info');
        
        // 自動選擇演示模式
        this.selectModel('demo');
        this.state.isDemoMode = true;
        
        // 載入計算器模板
        setTimeout(() => {
          this.loadTemplate('calculator');
          this.showStatus('✅ 快速設定完成！已切換到演示模式', 'homeStatus', 'success');
        }, 500);
      }
      
      // 匯出金鑰
      exportKeys() {
        const keys = {
          deepseek: this.state.apiKeys.deepseek,
          openrouter: this.state.apiKeys.openrouter,
          timestamp: new Date().toISOString(),
          platform: 'AI教學平台'
        };
        
        const dataStr = JSON.stringify(keys, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `ai_teaching_keys_${new Date().toISOString().slice(0,10)}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        this.showStatus('✅ API金鑰已匯出', 'homeStatus', 'success');
      }
      
      // 匯入金鑰
      importKeys() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const keys = JSON.parse(event.target.result);
              
              // 驗證匯入的資料
              if (keys.deepseek && typeof keys.deepseek === 'string') {
                this.state.apiKeys.deepseek = keys.deepseek;
              }
              if (keys.openrouter && typeof keys.openrouter === 'string') {
                this.state.apiKeys.openrouter = keys.openrouter;
              }
              
              this.saveState();
              this.updateKeyDisplays();
              this.showStatus('✅ API金鑰已匯入', 'homeStatus', 'success');
              
            } catch (error) {
              this.showStatus('❌ 匯入失敗：檔案格式錯誤', 'homeStatus', 'error');
            }
          };
          reader.readAsText(file);
        };
        
        input.click();
      }
      
      // 清除本地資料
      clearLocalData() {
        if (confirm('確定要清除所有本地資料嗎？這將刪除所有API金鑰和設定。')) {
          localStorage.removeItem('ai_teaching_platform_state');
          localStorage.removeItem('ai_teaching_platform_keys');
          localStorage.removeItem('ai_teaching_platform_progress');
          
          // 清除所有備份
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('ai_teaching_backup_')) {
              localStorage.removeItem(key);
            }
          }
          
          // 重置狀態
          this.state.apiKeys.deepseek = '';
          this.state.apiKeys.openrouter = '';
          this.state.progress = {
            model: false,
            analysis: false,
            ipo: false,
            code: false,
            teach: false
          };
          
          this.updateKeyDisplays();
          this.updateProgressDisplay();
          this.showStatus('✅ 所有本地資料已清除', 'homeStatus', 'success');
        }
      }
      
      // 備份資料
      backupData() {
        this.saveState();
        this.createTimestampBackup();
        this.showStatus('✅ 資料已備份', 'homeStatus', 'success');
      }
      
      // 載入教學模板
      loadTemplate(templateId) {
        const template = this.templates[templateId];
        if (!template) return;
        
        // 設定問題
        document.getElementById('promptInput').value = template.problem;
        
        // 切換到AI分析頁
        this.switchTab('api');
        
        this.showStatus(`✅ 已載入「${template.name}」教學模板`, 'apiStatus', 'success');
      }
      
      // 快速開始
      quickStart() {
        // 自動選擇演示模式
        this.selectModel('demo');
        this.state.isDemoMode = true;
        
        // 載入計算器模板
        this.loadTemplate('calculator');
        
        // 自動執行分析
        setTimeout(() => {
          this.analyzeWithAI();
        }, 500);
        
        this.showStatus('🚀 快速教學流程已啟動！', 'homeStatus', 'success');
      }
      
      // 啟用演示模式
      enableDemoMode() {
        this.state.isDemoMode = true;
        this.selectModel('demo');
        this.showStatus('🔧 演示模式已啟用，無需API金鑰', 'homeStatus', 'success');
      }
      
      // 重置進度
      resetProgress() {
        if (confirm('確定要重置教學進度嗎？這不會刪除API金鑰。')) {
          this.state.progress = {
            model: false,
            analysis: false,
            ipo: false,
            code: false,
            teach: false
          };
          
          // 清除專案資料
          this.state.projectData = {};
          
          // 清除表單內容
          document.getElementById('promptInput').value = '';
          document.getElementById('aiResponse').textContent = '等待AI回應...請點擊上方按鈕發送分析請求。';
          document.getElementById('ipoInput').value = '';
          document.getElementById('ipoProcess').value = '';
          document.getElementById('ipoOutput').value = '';
          document.getElementById('codeOutput').value = '';
          document.getElementById('teachingContent').value = '';
          
          this.updateProgressDisplay();
          this.updateProcessFlow('home');
          this.switchTab('home');
          this.saveState();
          
          this.showStatus('🔄 教學進度已重置', 'homeStatus', 'success');
        }
      }
      
      // 使用AI分析
      async analyzeWithAI() {
        const prompt = document.getElementById('promptInput').value.trim();
        if (!prompt) {
          this.showStatus('請輸入要分析的程式設計問題', 'apiStatus', 'warning');
          return;
        }
        
        const model = this.models[this.state.currentModel];
        const responseArea = document.getElementById('aiResponse');
        
        // 顯示載入狀態
        responseArea.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <div>正在使用 ${model.name} 分析問題...</div>
          </div>
        `;
        
        try {
          let analysisResult;
          
          if (model.endpoint && !this.state.isDemoMode) {
            // 真實API請求
            const apiKey = model.provider === 'DeepSeek' ? 
              this.state.apiKeys.deepseek : this.state.apiKeys.openrouter;
              
            if (!apiKey) {
              throw new Error('請先設定API金鑰或使用演示模式');
            }
            
            analysisResult = await this.callAIAPI(model, prompt, apiKey);
          } else {
            // 演示模式 - 使用預設回應
            await new Promise(resolve => setTimeout(resolve, 1500));
            analysisResult = this.getDemoAnalysis(prompt);
          }
          
          // 顯示分析結果
          responseArea.textContent = analysisResult;
          
          // 更新進度
          this.state.progress.analysis = true;
          this.updateProgressDisplay();
          
          // 儲存到歷史記錄
          this.saveToHistory({
            timestamp: new Date().toLocaleString(),
            model: model.name,
            prompt: prompt.substring(0, 100) + (prompt.length > 100 ? '...' : ''),
            result: analysisResult.substring(0, 500) + (analysisResult.length > 500 ? '...' : '')
          });
          
          this.showStatus(`✅ ${model.name} 分析完成`, 'apiStatus', 'success');
          
        } catch (error) {
          console.error('AI分析失敗:', error);
          
          // 失敗時使用演示模式
          const demoResult = this.getDemoAnalysis(prompt);
          responseArea.textContent = `⚠️ 真實API請求失敗，已使用演示模式：\n\n${demoResult}`;
          
          this.state.progress.analysis = true;
          this.updateProgressDisplay();
          
          this.showStatus('⚠️ 自動切換到演示模式', 'apiStatus', 'warning');
        }
      }
      
      // 呼叫AI API
      async callAIAPI(model, prompt, apiKey) {
        const requestBody = {
          model: model.provider === 'DeepSeek' ? 'deepseek-chat' : 'x-ai/grok-4.1-fast',
          messages: [
            {
              role: 'user',
              content: `請詳細分析以下程式設計問題的IPO結構：

問題：「${prompt}」

請提供詳細的分析，包括：
1. 📥 Input（輸入）：所有需要的輸入資料、來源、格式和驗證規則
2. ⚙️ Process（處理）：詳細的處理步驟、演算法、業務邏輯和錯誤處理
3. 📤 Output（輸出）：輸出內容、格式、呈現方式和擴充可能

請使用適合教學的結構化格式，並考慮實際開發的可行性。`
            }
          ],
          max_tokens: model.maxTokens,
          temperature: 0.7
        };
        
        // 添加推理模式（如果是Grok）
        if (model.supportsReasoning && this.state.enableReasoning) {
          requestBody.reasoning = { enabled: true };
        }
        
        const response = await fetch(model.endpoint, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });
        
        if (!response.ok) {
          throw new Error(`API錯誤: ${response.status}`);
        }
        
        const data = await response.json();
        let content = data.choices?.[0]?.message?.content || '無回應內容';
        
        // 如果有推理內容，添加到開頭
        if (data.choices?.[0]?.message?.reasoning) {
          content = `🧠 推理過程：\n${data.choices[0].message.reasoning}\n\n💡 分析結果：\n${content}`;
        }
        
        return content;
      }
      
      // 獲取演示分析
      getDemoAnalysis(prompt) {
        return `🤖 ${this.models[this.state.currentModel].name} 分析結果（演示模式）：

問題：「${prompt}」

📥 Input（輸入）分析：
=====================
1. 資料來源
   • 使用者輸入：透過表單、指令行或API接口
   • 檔案系統：CSV、JSON、Excel檔案
   • 資料庫：SQL或NoSQL資料庫查詢結果
   • 外部API：第三方服務提供的資料

2. 輸入格式
   • 文字：純文字、標記語言（Markdown/HTML）
   • 數字：整數、浮點數、科學記號
   • 結構化資料：JSON、XML、YAML
   • 檔案：二進位或文字檔案

3. 驗證規則
   • 格式驗證：正則表達式匹配
   • 範圍驗證：數字範圍、長度限制
   • 必填檢查：必要欄位驗證
   • 唯一性檢查：避免重複資料
   • 關聯驗證：資料之間的關聯性

4. 錯誤處理機制
   • 即時驗證：使用者輸入時立即回饋
   • 批次驗證：檔案匯入時的批次檢查
   • 錯誤訊息：清晰明確的錯誤提示
   • 修正建議：提供具體修正建議

⚙️ Process（處理）流程：
=======================
1. 資料預處理
   • 資料清洗：去除無效或重複資料
   • 格式轉換：統一資料格式和單位
   • 缺失值處理：填充或標記缺失資料
   • 標準化：資料正規化處理

2. 核心演算法
   • 主要計算：實現業務邏輯的核心計算
   • 資料轉換：資料結構的轉換和重組
   • 搜尋排序：資料檢索和排序演算法
   • 統計分析：資料統計和模式識別

3. 業務邏輯
   • 規則引擎：業務規則的判斷和執行
   • 狀態管理：系統狀態的追蹤和管理
   • 交易處理：資料一致性和完整性
   • 效能優化：時間和空間複雜度考量

4. 錯誤與例外處理
   • 異常偵測：系統異常的偵測機制
   • 錯誤恢復：錯誤發生後的恢復策略
   • 日誌記錄：詳細的執行日誌記錄
   • 監控警報：系統監控和異常警報

📤 Output（輸出）規劃：
======================
1. 主要輸出
   • 計算結果：主要功能的輸出結果
   • 分析報告：詳細的分析報告和統計
   • 視覺化：圖表、圖形和儀表板
   • 檔案輸出：可下載的檔案格式

2. 輸出格式
   • 文字格式：純文字、PDF、HTML
   • 資料格式：JSON、XML、CSV、Excel
   • 圖形格式：PNG、SVG、PDF
   • 互動格式：網頁應用、API回應

3. 錯誤輸出
   • 錯誤報告：詳細的錯誤報告
   • 除錯資訊：開發者需要的除錯資訊
   • 使用者指引：使用者可理解的錯誤指引
   • 聯絡資訊：技術支援聯絡方式

4. 擴充輸出
   • API接口：可供其他系統呼叫的API
   • 外掛系統：可擴充的外掛架構
   • 匯出功能：多種格式的匯出功能
   • 整合輸出：與其他系統的整合輸出

💡 教學建議：
============
1. 開發策略
   • 採用迭代開發，每階段都有可展示成果
   • 實作最小可行產品，逐步增加功能
   • 重視程式碼品質和可維護性
   • 建立完整的測試覆蓋

2. 教學重點
   • 強調IPO分析的邏輯性
   • 注重錯誤處理和邊界條件
   • 培養系統設計和架構能力
   • 提升問題解決和除錯能力

3. 評估標準
   • 功能完整性：是否滿足所有需求
   • 程式碼品質：可讀性、可維護性
   • 效能表現：回應時間和資源使用
   • 使用者體驗：介面友好度和易用性

🎯 實作路線圖：
===============
第1階段：基礎架構（1-2週）
   • 建立專案結構
   • 實作核心資料結構
   • 完成基本CRUD功能

第2階段：核心功能（2-3週）
   • 實作主要業務邏輯
   • 加入錯誤處理機制
   • 建立基本使用者介面

第3階段：進階功能（2-3週）
   • 實作進階功能
   • 優化系統效能
   • 加入擴充機制

第4階段：測試部署（1-2週）
   • 完成單元測試和整合測試
   • 進行效能測試和壓力測試
   • 部署到生產環境`;
      }
      
      // 儲存到歷史記錄
      saveToHistory(analysis) {
        this.state.analysisHistory.unshift(analysis);
        if (this.state.analysisHistory.length > 10) {
          this.state.analysisHistory.pop();
        }
        this.saveState();
        this.loadAnalysisHistory();
      }
      
      // 載入分析歷史
      loadAnalysisHistory() {
        const historyArea = document.getElementById('analysisHistory');
        
        if (this.state.analysisHistory.length === 0) {
          historyArea.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">尚無分析記錄</div>';
          return;
        }
        
        historyArea.innerHTML = this.state.analysisHistory.map((item, index) => `
          <div style="border-bottom: 1px solid var(--border-light); padding: 0.5rem 0; margin-bottom: 0.5rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <strong style="color: var(--primary);">${item.timestamp}</strong>
              <span class="badge badge-primary">${item.model}</span>
            </div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">
              ${item.prompt}
            </div>
            <div style="font-size: 0.75rem; color: var(--text-muted);">
              ${item.result}
            </div>
          </div>
        `).join('');
      }
      
      // 應用分析結果到IPO並下一步
      applyToIPOAndNext() {
        this.applyToIPO();
        setTimeout(() => {
          this.switchTab('ipo');
        }, 300);
      }
      
      // 應用分析結果到IPO
      applyToIPO() {
        const analysis = document.getElementById('aiResponse').textContent;
        
        if (!analysis || analysis.includes('等待AI回應')) {
          this.showStatus('請先完成AI分析', 'apiStatus', 'warning');
          return;
        }
        
        // 簡單解析分析結果（實際應用中可以更智能）
        const lines = analysis.split('\n');
        let currentSection = '';
        let inputContent = [];
        let processContent = [];
        let outputContent = [];
        
        for (const line of lines) {
          if (line.includes('📥 Input') || line.includes('輸入')) {
            currentSection = 'input';
            continue;
          } else if (line.includes('⚙️ Process') || line.includes('處理')) {
            currentSection = 'process';
            continue;
          } else if (line.includes('📤 Output') || line.includes('輸出')) {
            currentSection = 'output';
            continue;
          }
          
          if (currentSection === 'input' && line.trim()) {
            inputContent.push(line);
          } else if (currentSection === 'process' && line.trim()) {
            processContent.push(line);
          } else if (currentSection === 'output' && line.trim()) {
            outputContent.push(line);
          }
        }
        
        // 更新IPO欄位
        if (inputContent.length > 0) {
          document.getElementById('ipoInput').value = inputContent.join('\n');
        }
        if (processContent.length > 0) {
          document.getElementById('ipoProcess').value = processContent.join('\n');
        }
        if (outputContent.length > 0) {
          document.getElementById('ipoOutput').value = outputContent.join('\n');
        }
        
        this.showStatus('✅ AI分析結果已應用至IPO設計', 'apiStatus', 'success');
      }
      
      // 儲存IPO分析
      saveIPOAnalysis() {
        const input = document.getElementById('ipoInput').value.trim();
        const process = document.getElementById('ipoProcess').value.trim();
        const output = document.getElementById('ipoOutput').value.trim();
        
        if (!input || !process || !output) {
          this.showStatus('請完整填寫IPO三個欄位', 'ipoStatus', 'warning');
          return;
        }
        
        this.state.projectData.ipo = {
          input: input,
          process: process,
          output: output,
          timestamp: new Date().toLocaleString()
        };
        
        // 更新進度
        this.state.progress.ipo = true;
        this.updateProgressDisplay();
        
        this.saveState();
        this.showStatus('✅ IPO設計已儲存！', 'ipoStatus', 'success');
      }
      
      // 驗證IPO完整性
      validateIPO() {
        const input = document.getElementById('ipoInput').value.trim();
        const process = document.getElementById('ipoProcess').value.trim();
        const output = document.getElementById('ipoOutput').value.trim();
        
        let issues = [];
        
        if (!input) issues.push('Input欄位為空');
        if (!process) issues.push('Process欄位為空');
        if (!output) issues.push('Output欄位為空');
        
        if (input && input.length < 50) issues.push('Input內容過於簡略');
        if (process && process.length < 50) issues.push('Process內容過於簡略');
        if (output && output.length < 50) issues.push('Output內容過於簡略');
        
        if (issues.length === 0) {
          this.showStatus('✅ IPO設計完整性驗證通過', 'ipoStatus', 'success');
        } else {
          this.showStatus(`⚠️ IPO設計完整性問題：${issues.join(', ')}`, 'ipoStatus', 'warning');
        }
      }
      
      // 從IPO生成程式碼
      generateCodeFromIPO() {
        if (!this.state.projectData.ipo) {
          this.showStatus('請先儲存IPO設計', 'ipoStatus', 'warning');
          return;
        }
        
        // 切換到程式碼頁面並生成程式碼
        this.switchTab('code');
        setTimeout(() => {
          this.generateCode();
        }, 100);
      }
      
      // 生成程式碼
      generateCode() {
        const ipo = this.state.projectData.ipo;
        if (!ipo) {
          this.showStatus('請先完成IPO設計', 'codeStatus', 'warning');
          return;
        }
        
        // 獲取選中的語言
        const selectedLang = document.querySelector('[data-lang].active');
        const language = selectedLang ? selectedLang.dataset.lang : 'python';
        
        let generatedCode = '';
        
        if (language === 'python') {
          generatedCode = this.generatePythonCode(ipo);
        } else if (language === 'javascript') {
          generatedCode = this.generateJavaScriptCode(ipo);
        } else if (language === 'java') {
          generatedCode = this.generateJavaCode(ipo);
        } else if (language === 'cpp') {
          generatedCode = this.generateCppCode(ipo);
        }
        
        document.getElementById('codeOutput').value = generatedCode;
        this.state.projectData.code = generatedCode;
        
        // 更新進度
        this.state.progress.code = true;
        this.updateProgressDisplay();
        
        this.saveState();
        
        this.showStatus(`✅ ${language} 程式碼已生成`, 'codeStatus', 'success');
      }
      
      // 生成Python程式碼
      generatePythonCode(ipo) {
        return `# 程式設計專案 - Python實作
# 基於IPO設計生成
# 生成時間: ${new Date().toLocaleString()}

"""
IPO設計摘要：
============
📥 Input:
${ipo.input}

⚙️ Process:
${ipo.process}

📤 Output:
${ipo.output}
"""

import json
import csv
from datetime import datetime
from typing import Dict, List, Optional, Any

class DataValidator:
    """資料驗證器"""
    @staticmethod
    def validate_input(data: Any, rules: Dict) -> bool:
        """驗證輸入資料"""
        try:
            # 檢查必要欄位
            required_fields = rules.get('required', [])
            for field in required_fields:
                if field not in data:
                    raise ValueError(f"缺少必要欄位: {field}")
            
            # 檢查資料類型
            type_rules = rules.get('types', {})
            for field, expected_type in type_rules.items():
                if field in data and not isinstance(data[field], expected_type):
                    raise TypeError(f"欄位 {field} 類型錯誤，應為 {expected_type}")
            
            # 檢查資料範圍
            range_rules = rules.get('ranges', {})
            for field, (min_val, max_val) in range_rules.items():
                if field in data:
                    if not (min_val <= data[field] <= max_val):
                        raise ValueError(f"欄位 {field} 超出範圍")
            
            return True
        except (ValueError, TypeError) as e:
            print(f"驗證失敗: {e}")
            return False

class DataProcessor:
    """資料處理器"""
    def __init__(self):
        self.data = {}
        self.results = {}
        
    def load_data(self, source: str, format_type: str = 'json'):
        """載入資料"""
        try:
            if format_type == 'json':
                with open(source, 'r', encoding='utf-8') as f:
                    self.data = json.load(f)
            elif format_type == 'csv':
                with open(source, 'r', encoding='utf-8') as f:
                    reader = csv.DictReader(f)
                    self.data = list(reader)
            else:
                raise ValueError(f"不支援的格式: {format_type}")
                
            print(f"成功載入 {len(self.data) if isinstance(self.data, list) else 1} 筆資料")
            return True
        except Exception as e:
            print(f"載入資料失敗: {e}")
            return False
    
    def process(self, algorithm: str, **kwargs):
        """處理資料"""
        try:
            print(f"開始執行處理演算法: {algorithm}")
            
            # 根據演算法執行對應處理
            if algorithm == 'calculate':
                self.results = self._calculate(kwargs)
            elif algorithm == 'analyze':
                self.results = self._analyze(kwargs)
            elif algorithm == 'transform':
                self.results = self._transform(kwargs)
            else:
                raise ValueError(f"未知的演算法: {algorithm}")
            
            print("處理完成")
            return True
        except Exception as e:
            print(f"處理失敗: {e}")
            return False
    
    def _calculate(self, params: Dict) -> Dict:
        """計算演算法"""
        # 實作具體計算邏輯
        return {"status": "calculated", "data": self.data}
    
    def _analyze(self, params: Dict) -> Dict:
        """分析演算法"""
        # 實作具體分析邏輯
        return {"status": "analyzed", "data": self.data}
    
    def _transform(self, params: Dict) -> Dict:
        """轉換演算法"""
        # 實作具體轉換邏輯
        return {"status": "transformed", "data": self.data}

class OutputGenerator:
    """輸出生成器"""
    @staticmethod
    def generate_report(data: Dict, format_type: str = 'text') -> str:
        """生成報告"""
        try:
            if format_type == 'text':
                report = f"報告生成時間: {datetime.now()}\\n"
                report += "=" * 50 + "\\n"
                for key, value in data.items():
                    report += f"{key}: {value}\\n"
                return report
                
            elif format_type == 'json':
                return json.dumps(data, ensure_ascii=False, indent=2)
                
            elif format_type == 'html':
                html = '''
                <!DOCTYPE html>
                <html>
                <head>
                    <title>分析報告</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { background: #4f46e5; color: white; padding: 20px; }
                        .content { margin: 20px 0; }
                        .item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>分析報告</h1>
                        <p>生成時間: ''' + datetime.now().strftime('%Y-%m-%d %H:%M:%S') + '''</p>
                    </div>
                    <div class="content">
                '''
                for key, value in data.items():
                    html += f'''
                        <div class="item">
                            <strong>{key}:</strong> {value}
                        </div>
                    '''
                html += '''
                    </div>
                </body>
                </html>
                '''
                return html
                
            else:
                raise ValueError(f"不支援的格式: {format_type}")
                
        except Exception as e:
            return f"生成報告失敗: {e}"
    
    @staticmethod
    def save_to_file(content: str, filename: str):
        """儲存到檔案"""
        try:
            with open(filename, 'w', encoding='utf-8') as f:
                f.write(content)
            print(f"檔案已儲存: {filename}")
            return True
        except Exception as e:
            print(f"儲存檔案失敗: {e}")
            return False

class MainSystem:
    """主系統"""
    def __init__(self):
        self.validator = DataValidator()
        self.processor = DataProcessor()
        self.generator = OutputGenerator()
        self.config = {
            'input_rules': {
                'required': ['id', 'name'],
                'types': {'id': str, 'name': str},
                'ranges': {'score': (0, 100)}
            }
        }
    
    def run(self, input_source: str, algorithm: str = 'calculate'):
        """執行主流程"""
        print("=" * 60)
        print("開始執行系統流程")
        print("=" * 60)
        
        # 1. 載入資料
        print("\\n📥 階段1: 載入資料")
        if not self.processor.load_data(input_source):
            return False
        
        # 2. 驗證資料
        print("\\n🔍 階段2: 驗證資料")
        if not self.validator.validate_input(self.processor.data, self.config['input_rules']):
            return False
        
        # 3. 處理資料
        print("\\n⚙️ 階段3: 處理資料")
        if not self.processor.process(algorithm):
            return False
        
        # 4. 生成輸出
        print("\\n📤 階段4: 生成輸出")
        report = self.generator.generate_report(self.processor.results, 'html')
        
        # 5. 儲存結果
        print("\\n💾 階段5: 儲存結果")
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        filename = f"report_{timestamp}.html"
        self.generator.save_to_file(report, filename)
        
        print("\\n" + "=" * 60)
        print("系統流程執行完成！")
        print("=" * 60)
        
        return True

# 使用範例
if __name__ == "__main__":
    # 建立系統實例
    system = MainSystem()
    
    # 執行系統
    success = system.run('input_data.json', 'analyze')
    
    if success:
        print("✅ 系統執行成功")
    else:
        print("❌ 系統執行失敗")
    
    # 教學提示
    print("\\n💡 教學提示：")
    print("1. 根據實際需求修改驗證規則")
    print("2. 實作具體的處理演算法")
    print("3. 擴充輸出格式支援")
    print("4. 加入日誌記錄和錯誤處理")
    print("5. 撰寫單元測試確保品質")`;
      }
      
      // 生成JavaScript程式碼
      generateJavaScriptCode(ipo) {
        return `// 程式設計專案 - JavaScript實作
// 基於IPO設計生成
// 生成時間: ${new Date().toLocaleString()}

/*
IPO設計摘要：
============
📥 Input:
${ipo.input}

⚙️ Process:
${ipo.process}

📤 Output:
${ipo.output}
*/

class DataValidator {
    /**
     * 驗證輸入資料
     * @param {Object} data - 要驗證的資料
     * @param {Object} rules - 驗證規則
     * @returns {boolean} - 驗證結果
     */
    static validateInput(data, rules) {
        try {
            // 檢查必要欄位
            const requiredFields = rules.required || [];
            for (const field of requiredFields) {
                if (!(field in data)) {
                    throw new Error(\`缺少必要欄位: \${field}\`);
                }
            }
            
            // 檢查資料類型
            const typeRules = rules.types || {};
            for (const [field, expectedType] of Object.entries(typeRules)) {
                if (field in data) {
                    const actualType = typeof data[field];
                    if (actualType !== expectedType) {
                        throw new Error(\`欄位 \${field} 類型錯誤，應為 \${expectedType}，實際為 \${actualType}\`);
                    }
                }
            }
            
            // 檢查資料範圍
            const rangeRules = rules.ranges || {};
            for (const [field, [minVal, maxVal]] of Object.entries(rangeRules)) {
                if (field in data) {
                    const value = data[field];
                    if (value < minVal || value > maxVal) {
                        throw new Error(\`欄位 \${field} 超出範圍 \${minVal}-\${maxVal}\`);
                    }
                }
            }
            
            return true;
        } catch (error) {
            console.error(\`驗證失敗: \${error.message}\`);
            return false;
        }
    }
}

class DataProcessor {
    constructor() {
        this.data = null;
        this.results = null;
    }
    
    /**
     * 載入資料
     * @param {string} source - 資料來源
     * @param {string} formatType - 資料格式
     * @returns {Promise<boolean>} - 載入結果
     */
    async loadData(source, formatType = 'json') {
        try {
            if (formatType === 'json') {
                const response = await fetch(source);
                this.data = await response.json();
            } else if (formatType === 'csv') {
                const response = await fetch(source);
                const text = await response.text();
                this.data = this.parseCSV(text);
            } else {
                throw new Error(\`不支援的格式: \${formatType}\`);
            }
            
            console.log(\`成功載入資料，數量: \${Array.isArray(this.data) ? this.data.length : 1}\`);
            return true;
        } catch (error) {
            console.error(\`載入資料失敗: \${error.message}\`);
            return false;
        }
    }
    
    /**
     * 解析CSV資料
     * @param {string} csvText - CSV文字內容
     * @returns {Array} - 解析後的資料
     */
    parseCSV(csvText) {
        const lines = csvText.split('\\n');
        const headers = lines[0].split(',');
        
        return lines.slice(1).map(line => {
            const values = line.split(',');
            const obj = {};
            headers.forEach((header, index) => {
                obj[header.trim()] = values[index] ? values[index].trim() : '';
            });
            return obj;
        });
    }
    
    /**
     * 處理資料
     * @param {string} algorithm - 處理演算法
     * @param {Object} params - 處理參數
     * @returns {boolean} - 處理結果
     */
    process(algorithm, params = {}) {
        try {
            console.log(\`開始執行處理演算法: \${algorithm}\`);
            
            switch (algorithm) {
                case 'calculate':
                    this.results = this._calculate(params);
                    break;
                case 'analyze':
                    this.results = this._analyze(params);
                    break;
                case 'transform':
                    this.results = this._transform(params);
                    break;
                default:
                    throw new Error(\`未知的演算法: \${algorithm}\`);
            }
            
            console.log('處理完成');
            return true;
        } catch (error) {
            console.error(\`處理失敗: \${error.message}\`);
            return false;
        }
    }
    
    _calculate(params) {
        // 實作具體計算邏輯
        return { status: 'calculated', data: this.data };
    }
    
    _analyze(params) {
        // 實作具體分析邏輯
        return { status: 'analyzed', data: this.data };
    }
    
    _transform(params) {
        // 實作具體轉換邏輯
        return { status: 'transformed', data: this.data };
    }
}

class OutputGenerator {
    /**
     * 生成報告
     * @param {Object} data - 要報告的資料
     * @param {string} formatType - 報告格式
     * @returns {string} - 生成的報告
     */
    static generateReport(data, formatType = 'text') {
        try {
            const timestamp = new Date().toLocaleString();
            
            if (formatType === 'text') {
                let report = \`報告生成時間: \${timestamp}\\n\`;
                report += '='.repeat(50) + '\\n';
                Object.entries(data).forEach(([key, value]) => {
                    report += \`\${key}: \${JSON.stringify(value)}\\n\`;
                });
                return report;
                
            } else if (formatType === 'json') {
                return JSON.stringify({ timestamp, ...data }, null, 2);
                
            } else if (formatType === 'html') {
                let html = \`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>分析報告</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        .header { 
                            background: #4f46e5; 
                            color: white; 
                            padding: 20px; 
                            border-radius: 8px;
                            margin-bottom: 20px;
                        }
                        .content { 
                            margin: 20px 0; 
                        }
                        .item { 
                            margin: 10px 0; 
                            padding: 15px; 
                            border: 1px solid #ddd; 
                            border-radius: 4px;
                            background: #f8fafc;
                        }
                        .item strong {
                            color: #4f46e5;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>分析報告</h1>
                        <p>生成時間: \${timestamp}</p>
                    </div>
                    <div class="content">
                \`;
                
                Object.entries(data).forEach(([key, value]) => {
                    html += \`
                        <div class="item">
                            <strong>\${key}:</strong> 
                            <pre>\${JSON.stringify(value, null, 2)}</pre>
                        </div>
                    \`;
                });
                
                html += \`
                    </div>
                </body>
                </html>
                \`;
                
                return html;
                
            } else {
                throw new Error(\`不支援的格式: \${formatType}\`);
            }
        } catch (error) {
            return \`生成報告失敗: \${error.message}\`;
        }
    }
    
    /**
     * 下載檔案
     * @param {string} content - 檔案內容
     * @param {string} filename - 檔案名稱
     */
    static downloadFile(content, filename) {
        try {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            console.log(\`檔案已下載: \${filename}\`);
        } catch (error) {
            console.error(\`下載檔案失敗: \${error.message}\`);
        }
    }
}

// 使用範例
document.addEventListener('DOMContentLoaded', () => {
    // 建立系統實例
    const processor = new DataProcessor();
    
    // 執行流程
    const runSystem = async () => {
        console.log('='.repeat(60));
        console.log('開始執行系統流程');
        console.log('='.repeat(60));
        
        try {
            // 1. 載入資料
            console.log('\\n📥 階段1: 載入資料');
            const loadSuccess = await processor.loadData('data.json');
            if (!loadSuccess) {
                throw new Error('載入資料失敗');
            }
            
            // 2. 處理資料
            console.log('\\n⚙️ 階段2: 處理資料');
            const processSuccess = processor.process('analyze');
            if (!processSuccess) {
                throw new Error('資料處理失敗');
            }
            
            // 3. 生成輸出
            console.log('\\n📤 階段3: 生成輸出');
            const report = OutputGenerator.generateReport(processor.results, 'html');
            
            // 4. 下載結果
            console.log('\\n💾 階段4: 下載結果');
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const filename = \`report_\${timestamp}.html\`;
            OutputGenerator.downloadFile(report, filename);
            
            console.log('\\n' + '='.repeat(60));
            console.log('系統流程執行完成！');
            console.log('='.repeat(60));
            
        } catch (error) {
            console.error(\`系統執行失敗: \${error.message}\`);
        }
    };
    
    // 教學提示
    console.log('💡 教學提示：');
    console.log('1. 根據實際需求修改驗證規則');
    console.log('2. 實作具體的處理演算法');
    console.log('3. 擴充輸出格式支援');
    console.log('4. 加入錯誤處理和日誌記錄');
    console.log('5. 撰寫單元測試確保品質');
});`;
      }
      
      // 生成Java程式碼（簡化版）
      generateJavaCode(ipo) {
        return `// 程式設計專案 - Java實作
// 基於IPO設計生成
// 生成時間: ${new Date().toLocaleString()}

/*
IPO設計摘要：
============
📥 Input:
${ipo.input}

⚙️ Process:
${ipo.process}

📤 Output:
${ipo.output}
*/

public class MainSystem {
    
    public static void main(String[] args) {
        System.out.println("=".repeat(60));
        System.out.println("開始執行系統流程");
        System.out.println("=".repeat(60));
        
        try {
            // 1. 載入資料
            System.out.println("\\n📥 階段1: 載入資料");
            boolean loadSuccess = loadData("input.txt");
            if (!loadSuccess) {
                throw new RuntimeException("載入資料失敗");
            }
            
            // 2. 處理資料
            System.out.println("\\n⚙️ 階段2: 處理資料");
            boolean processSuccess = processData();
            if (!processSuccess) {
                throw new RuntimeException("資料處理失敗");
            }
            
            // 3. 生成輸出
            System.out.println("\\n📤 階段3: 生成輸出");
            String report = generateReport();
            
            // 4. 儲存結果
            System.out.println("\\n💾 階段4: 儲存結果");
            boolean saveSuccess = saveToFile(report, "output.txt");
            
            System.out.println("\\n" + "=".repeat(60));
            System.out.println("系統流程執行完成！");
            System.out.println("=".repeat(60));
            
        } catch (Exception e) {
            System.err.println("系統執行失敗: " + e.getMessage());
        }
    }
    
    private static boolean loadData(String filename) {
        // 實作資料載入邏輯
        return true;
    }
    
    private static boolean processData() {
        // 實作資料處理邏輯
        return true;
    }
    
    private static String generateReport() {
        // 實作報告生成邏輯
        return "分析報告內容";
    }
    
    private static boolean saveToFile(String content, String filename) {
        // 實作檔案儲存邏輯
        return true;
    }
}`;
      }
      
      // 生成C++程式碼（簡化版）
      generateCppCode(ipo) {
        return `// 程式設計專案 - C++實作
// 基於IPO設計生成
// 生成時間: ${new Date().toLocaleString()}

/*
IPO設計摘要：
============
📥 Input:
${ipo.input}

⚙️ Process:
${ipo.process}

📤 Output:
${ipo.output}
*/

#include <iostream>
#include <string>

using namespace std;

int main() {
    cout << string(60, '=') << endl;
    cout << "開始執行系統流程" << endl;
    cout << string(60, '=') << endl;
    
    try {
        // 1. 載入資料
        cout << "\\n📥 階段1: 載入資料" << endl;
        if (!loadData()) {
            throw runtime_error("載入資料失敗");
        }
        
        // 2. 處理資料
        cout << "\\n⚙️ 階段2: 處理資料" << endl;
        if (!processData()) {
            throw runtime_error("資料處理失敗");
        }
        
        // 3. 生成輸出
        cout << "\\n📤 階段3: 生成輸出" << endl;
        string report = generateReport();
        
        // 4. 儲存結果
        cout << "\\n💾 階段4: 儲存結果" << endl;
        if (!saveToFile(report)) {
            throw runtime_error("儲存結果失敗");
        }
        
        cout << "\\n" << string(60, '=') << endl;
        cout << "系統流程執行完成！" << endl;
        cout << string(60, '=') << endl;
        
    } catch (const exception& e) {
        cerr << "系統執行失敗: " << e.what() << endl;
    }
    
    return 0;
}

bool loadData() {
    // 實作資料載入邏輯
    return true;
}

bool processData() {
    // 實作資料處理邏輯
    return true;
}

string generateReport() {
    // 實作報告生成邏輯
    return "分析報告內容";
}

bool saveToFile(const string& content) {
    // 實作檔案儲存邏輯
    return true;
}`;
      }
      
      // 複製程式碼到剪貼簿
      copyCodeToClipboard() {
        const codeArea = document.getElementById('codeOutput');
        if (!codeArea.value.trim()) {
          this.showStatus('請先生成程式碼', 'codeStatus', 'warning');
          return;
        }
        
        codeArea.select();
        codeArea.setSelectionRange(0, 99999); // 用於行動裝置
        
        try {
          const successful = document.execCommand('copy');
          if (successful) {
            this.showStatus('✅ 程式碼已複製到剪貼簿', 'codeStatus', 'success');
          } else {
            this.showStatus('❌ 複製失敗，請手動複製', 'codeStatus', 'error');
          }
        } catch (err) {
          console.error('複製失敗:', err);
          this.showStatus('❌ 複製失敗，請手動複製', 'codeStatus', 'error');
        }
      }
      
      // 下載程式碼
      downloadCode() {
        const codeArea = document.getElementById('codeOutput');
        const code = codeArea.value.trim();
        
        if (!code) {
          this.showStatus('請先生成程式碼', 'codeStatus', 'warning');
          return;
        }
        
        // 獲取選中的語言
        const selectedLang = document.querySelector('[data-lang].active');
        const language = selectedLang ? selectedLang.dataset.lang : 'python';
        
        const filename = `generated_code.${language === 'python' ? 'py' : 
                         language === 'javascript' ? 'js' : 
                         language === 'java' ? 'java' : 'cpp'}`;
        
        const blob = new Blob([code], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        this.showStatus(`✅ 程式碼已下載為 ${filename}`, 'codeStatus', 'success');
      }
      
      // 選擇程式語言
      selectLanguage(lang) {
        document.querySelectorAll('[data-lang]').forEach(btn => {
          btn.classList.remove('active');
        });
        
        const selectedBtn = document.querySelector(`[data-lang="${lang}"]`);
        if (selectedBtn) {
          selectedBtn.classList.add('active');
        }
        
        // 如果已經有程式碼，重新生成
        if (this.state.projectData.ipo) {
          this.generateCode();
        }
      }
      
      // 選擇教學資源類型
      selectResourceType(resourceType) {
        // 更新UI
        document.querySelectorAll('[data-resource]').forEach(card => {
          card.classList.remove('active');
        });
        
        const selectedCard = document.querySelector(`[data-resource="${resourceType}"]`);
        if (selectedCard) {
          selectedCard.classList.add('active');
        }
      }
      
      // 生成教學資源
      generateTeachingResource() {
        const resourceType = document.querySelector('[data-resource].active')?.dataset.resource;
        if (!resourceType) {
          this.showStatus('請先選擇教學資源類型', 'teachStatus', 'warning');
          return;
        }
        
        let content = '';
        
        switch(resourceType) {
          case 'slides':
            content = this.generateSlideContent();
            break;
          case 'lessonplan':
            content = this.generateLessonPlan();
            break;
          case 'worksheet':
            content = this.generateWorksheet();
            break;
          case 'assessment':
            content = this.generateAssessment();
            break;
          case 'project':
            content = this.generateProject();
            break;
          case 'video':
            content = this.generateVideoScript();
            break;
        }
        
        document.getElementById('teachingContent').value = content;
        
        // 更新進度
        this.state.progress.teach = true;
        this.updateProgressDisplay();
        this.saveState();
        
        this.showStatus(`✅ ${this.getResourceName(resourceType)} 已生成`, 'teachStatus', 'success');
      }
      
      // 獲取資源名稱
      getResourceName(resourceType) {
        const names = {
          slides: '教學簡報',
          lessonplan: '教案設計',
          worksheet: '學習單',
          assessment: '測驗題庫',
          project: '專案作業',
          video: '教學影片腳本'
        };
        return names[resourceType] || '教學資源';
      }
      
      // 生成教學簡報內容
      generateSlideContent() {
        return `【教學簡報大綱｜學生成績管理系統】

🎯 第1頁：課程標題
• 主標題：從IPO分析到程式實作
• 副標題：學生成績管理系統開發
• 講師：[講師姓名]
• 課程：程式設計與演算法
• 時間：2小時
• 適用對象：程式設計初學者

🎯 第2頁：學習目標
• 知識目標：
  - 理解IPO分析的基本概念
  - 掌握系統設計的基本原則
  - 了解物件導向程式設計
• 技能目標：
  - 能夠進行IPO分析
  - 能夠設計類別結構
  - 能夠實作基本功能
• 態度目標：
  - 培養邏輯思維能力
  - 建立系統化思考習慣
  - 提升問題解決能力

📋 第3頁：課程大綱
1. 問題分析與需求理解（15分鐘）
   - 系統需求分析
   - 使用者故事撰寫
   - 功能規格定義
2. IPO結構設計（20分鐘）
   - Input分析與設計
   - Process流程設計
   - Output設計與規劃
3. 程式模組劃分（20分鐘）
   - 類別設計原則
   - 模組職責劃分
   - 介面設計規範
4. 核心功能實作（30分鐘）
   - 資料驗證實作
   - 業務邏輯實作
   - 資料處理實作
5. 測試與驗證（15分鐘）
   - 單元測試設計
   - 整合測試方法
   - 系統驗證流程
6. 總結與延伸學習（10分鐘）
   - 本節重點回顧
   - 延伸學習方向
   - 實作建議與提示

... [其他頁面內容] ...`;
      }
      
      // 生成教案設計
      generateLessonPlan() {
        return `【教案設計｜學生成績管理系統開發】

📋 課程基本資訊
• 課程名稱：程式設計與演算法
• 教學單元：學生成績管理系統開發
• 教學對象：大學一年級學生
• 先備知識：基礎程式設計概念
• 教學時間：2小時（120分鐘）
• 教學地點：電腦教室
• 教學資源：電腦、投影設備、開發環境

🎯 教學目標
1. 認知目標：
   • 理解IPO分析的基本概念和應用
   • 掌握系統設計的基本原則和方法
   • 了解物件導向程式設計的核心概念

2. 技能目標：
   • 能夠進行IPO分析並設計系統架構
   • 能夠設計類別結構和實作基本功能
   • 能夠撰寫測試程式並驗證系統功能

3. 情意目標：
   • 培養邏輯思維和系統化思考能力
   • 建立嚴謹的程式設計態度和習慣
   • 提升問題解決和團隊合作能力

... [其他內容] ...`;
      }
      
      // 生成學習單
      generateWorksheet() {
        return `【學習單｜學生成績管理系統開發】

📝 學生姓名：________________ 學號：________________ 日期：________________

🎯 學習目標
完成本學習單後，你將能夠：
1. 理解IPO分析的基本概念
2. 設計學生成績管理系統的類別結構
3. 實作基本的成績計算功能
4. 撰寫測試程式驗證系統功能

📚 知識回顧
1. IPO分析是什麼？
   IPO代表：________、________、________

2. 物件導向程式設計的四大特性是什麼？
   ________、________、________、________

3. 在學生成績管理系統中，可能需要哪些類別？
   ________、________、________

... [其他內容] ...`;
      }
      
      // 生成測驗題庫
      generateAssessment() {
        return `【測驗題庫｜學生成績管理系統】

📝 測驗說明
• 測驗時間：60分鐘
• 總分：100分
• 題型：選擇題、簡答題、程式題
• 注意事項：請獨立完成，誠實作答

🎯 測驗目標
評估學生對以下內容的理解和掌握：
1. IPO分析的概念和應用
2. 物件導向程式設計原則
3. 系統設計和實作能力
4. 測試和除錯技巧

──────────────────────────────
第一部分：選擇題（每題2分，共20分）
──────────────────────────────

1. IPO分析中的"P"代表什麼？
   A) Program
   B) Process
   C) Project
   D) Procedure

2. 下列哪個不是物件導向程式設計的特性？
   A) 封裝
   B) 繼承
   C) 多型
   D) 順序

... [其他題目] ...`;
      }
      
      // 生成專案作業
      generateProject() {
        return `【專案作業｜學生成績管理系統開發】

📋 專案基本資訊
• 專案名稱：學生成績管理系統
• 課程名稱：程式設計與演算法
• 適用對象：大學一年級學生
• 專案類型：個人或小組專案（建議2-3人）
• 預計時程：2-3週
• 提交方式：GitHub Repository + 書面報告

🎯 專案目標
透過本專案的實作，學生將能夠：
1. 應用IPO分析方法進行系統設計
2. 實踐物件導向程式設計原則
3. 體驗完整的軟體開發流程
4. 培養團隊合作和專案管理能力
5. 提升問題解決和除錯技巧

... [其他內容] ...`;
      }
      
      // 生成教學影片腳本
      generateVideoScript() {
        return `【教學影片腳本｜學生成績管理系統開發】

🎬 影片資訊
• 影片標題：從IPO分析到程式實作：學生成績管理系統開發
• 影片長度：15-20分鐘
• 影片類型：教學演示影片
• 目標觀眾：程式設計初學者
• 學習目標：理解IPO分析，掌握系統設計，實作完整專案

📋 影片大綱
1. 開場介紹（0:00-1:00）
2. 問題分析與IPO設計（1:00-4:00）
3. 類別設計與架構規劃（4:00-7:00）
4. 核心功能實作（7:00-12:00）
5. 測試與驗證（12:00-14:00）
6. 總結與延伸（14:00-15:00）

🎥 分鏡腳本

【開場部分】（0:00-1:00）
畫面1：片頭動畫
• 畫面：AI教學平台Logo動畫，標題顯示
• 音效：輕快的開場音樂
• 旁白：歡迎來到AI教學平台！今天我們要學習如何開發一個學生成績管理系統。

畫面2：講師介紹
• 畫面：講師出現在畫面右側，左側顯示課程標題
• 旁白：我是[講師姓名]，今天將帶領大家從IPO分析開始，完成一個完整的系統開發。

... [其他內容] ...`;
      }
      
      // 匯出教學資源
      exportResource() {
        const content = document.getElementById('teachingContent').value.trim();
        if (!content) {
          this.showStatus('請先生成教學資源內容', 'teachStatus', 'warning');
          return;
        }
        
        const selectedResource = document.querySelector('[data-resource].active')?.dataset.resource;
        const resourceName = this.getResourceName(selectedResource || 'resource');
        
        const filename = `${resourceName}_${new Date().toISOString().slice(0, 10)}.md`;
        
        const blob = new Blob([content], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        this.showStatus(`✅ ${resourceName} 已匯出為 ${filename}`, 'teachStatus', 'success');
      }
      
      // 完成流程
      completeProcess() {
        this.state.progress.teach = true;
        this.updateProgressDisplay();
        this.saveState();
        
        this.showStatus('🎉 恭喜！您已完成完整的教學流程', 'teachStatus', 'success');
        
        // 顯示完成統計
        setTimeout(() => {
          const completed = Object.values(this.state.progress).filter(v => v).length;
          const total = Object.keys(this.state.progress).length;
          const percent = Math.round((completed / total) * 100);
          
          alert(`🏆 教學流程完成！\n\n完成項目：${completed}/${total}\n完成度：${percent}%\n\n您的API金鑰已永久儲存，下次使用時無需重新設定。`);
        }, 500);
      }
      
      // 測試當前模型
      async testCurrentModel() {
        const model = this.models[this.state.currentModel];
        
        if (model.requiresKey && !this.state.isDemoMode) {
          const apiKey = model.provider === 'DeepSeek' ? 
            this.state.apiKeys.deepseek : this.state.apiKeys.openrouter;
          
          if (!apiKey) {
            this.showStatus(`請先設定${model.provider} API金鑰`, 'modelStatus', 'warning');
            return;
          }
          
          await this.testAPIKey(model.provider.toLowerCase());
        } else {
          this.showStatus(`✅ ${model.name} 演示模式可用`, 'modelStatus', 'success');
        }
      }
      
      // 測試所有API
      async testAllAPIs() {
        this.switchTab('test');
        this.showStatus('🧪 開始測試所有API...', 'testLog', 'info');
        
        const logArea = document.getElementById('testLog');
        logArea.textContent = '';
        
        // 測試DeepSeek API
        await this.testSingleAPI('DeepSeek', this.state.apiKeys.deepseek, 
          'https://api.deepseek.com/v1/models');
        
        // 測試OpenRouter API
        await this.testSingleAPI('OpenRouter', this.state.apiKeys.openrouter,
          'https://openrouter.ai/api/v1/models');
        
        this.showStatus('✅ 所有API測試完成', 'testLog', 'success');
      }
      
      // 測試單個API
      async testSingleAPI(name, key, endpoint) {
        const logArea = document.getElementById('testLog');
        
        logArea.textContent += `\n🔍 測試 ${name} API...\n`;
        
        if (!key) {
          logArea.textContent += `   ⚠️ 未設定API金鑰，跳過測試\n`;
          return;
        }
        
        try {
          const startTime = Date.now();
          const response = await fetch(endpoint, {
            headers: {
              'Authorization': `Bearer ${key}`,
              'Content-Type': 'application/json'
            }
          });
          
          const endTime = Date.now();
          const responseTime = endTime - startTime;
          
          if (response.ok) {
            logArea.textContent += `   ✅ ${name} API連接成功 (${responseTime}ms)\n`;
          } else {
            logArea.textContent += `   ❌ ${name} API連接失敗: HTTP ${response.status}\n`;
          }
        } catch (error) {
          logArea.textContent += `   ❌ ${name} API連接錯誤: ${error.message}\n`;
        }
      }
      
      // 運行所有測試
      async runAllTests() {
        this.switchTab('test');
        const logArea = document.getElementById('testLog');
        
        logArea.textContent = '🧪 開始執行完整測試套件...\n\n';
        
        // 測試1: API連接
        logArea.textContent += '1. 測試API連接...\n';
        await this.testAllAPIs();
        
        // 測試2: 系統功能
        logArea.textContent += '\n2. 測試系統功能...\n';
        await this.testSystemFunctions();
        
        // 測試3: 程式碼生成
        logArea.textContent += '\n3. 測試程式碼生成...\n';
        await this.testCodeGeneration();
        
        // 測試4: 儲存系統
        logArea.textContent += '\n4. 測試儲存系統...\n';
        await this.testStorage();
        
        // 顯示總結
        setTimeout(() => {
          logArea.textContent += '\n✅ 測試套件執行完成！\n';
          logArea.textContent += '• 所有測試項目已完成\n';
          logArea.textContent += '• 檢查上方日誌了解詳細結果\n';
          
          this.updateTestResults();
        }, 500);
      }
      
      // 測試系統功能
      async testSystemFunctions() {
        const logArea = document.getElementById('testLog');
        
        // 測試IPO分析功能
        logArea.textContent += '   • 測試IPO分析功能...';
        const ipoInput = document.getElementById('ipoInput');
        const ipoProcess = document.getElementById('ipoProcess');
        const ipoOutput = document.getElementById('ipoOutput');
        
        if (ipoInput && ipoProcess && ipoOutput) {
          logArea.textContent += ' ✅ 正常\n';
        } else {
          logArea.textContent += ' ❌ 異常\n';
        }
        
        // 測試程式碼生成功能
        logArea.textContent += '   • 測試程式碼生成功能...';
        const codeOutput = document.getElementById('codeOutput');
        if (codeOutput) {
          logArea.textContent += ' ✅ 正常\n';
        } else {
          logArea.textContent += ' ❌ 異常\n';
        }
        
        // 測試教學資源生成
        logArea.textContent += '   • 測試教學資源生成...';
        const teachingContent = document.getElementById('teachingContent');
        if (teachingContent) {
          logArea.textContent += ' ✅ 正常\n';
        } else {
          logArea.textContent += ' ❌ 異常\n';
        }
      }
      
      // 測試程式碼生成
      async testCodeGeneration() {
        const logArea = document.getElementById('testLog');
        
        // 測試Python程式碼生成
        logArea.textContent += '   • 測試Python程式碼生成...';
        try {
          const pythonCode = this.generatePythonCode({
            input: '測試輸入',
            process: '測試處理',
            output: '測試輸出'
          });
          
          if (pythonCode && pythonCode.includes('class')) {
            logArea.textContent += ' ✅ 正常\n';
          } else {
            logArea.textContent += ' ❌ 異常\n';
          }
        } catch (error) {
          logArea.textContent += ` ❌ 錯誤: ${error.message}\n`;
        }
        
        // 測試JavaScript程式碼生成
        logArea.textContent += '   • 測試JavaScript程式碼生成...';
        try {
          const jsCode = this.generateJavaScriptCode({
            input: '測試輸入',
            process: '測試處理',
            output: '測試輸出'
          });
          
          if (jsCode && jsCode.includes('class')) {
            logArea.textContent += ' ✅ 正常\n';
          } else {
            logArea.textContent += ' ❌ 異常\n';
          }
        } catch (error) {
          logArea.textContent += ` ❌ 錯誤: ${error.message}\n`;
        }
      }
      
      // 測試儲存系統
      async testStorage() {
        const logArea = document.getElementById('testLog');
        
        logArea.textContent += '   • 測試本地儲存...';
        try {
          // 測試localStorage可用性
          const testKey = '__storage_test__';
          const testValue = 'test_' + Date.now();
          
          localStorage.setItem(testKey, testValue);
          const retrieved = localStorage.getItem(testKey);
          localStorage.removeItem(testKey);
          
          if (retrieved === testValue) {
            logArea.textContent += ' ✅ 正常\n';
          } else {
            logArea.textContent += ' ❌ 異常\n';
          }
        } catch (error) {
          logArea.textContent += ` ❌ 錯誤: ${error.message}\n`;
        }
        
        logArea.textContent += '   • 測試API金鑰儲存...';
        try {
          const originalKeys = { ...this.state.apiKeys };
          
          // 模擬變更
          this.state.apiKeys.deepseek = 'test_key_' + Date.now();
          this.saveState();
          
          // 重新載入
          const savedKeys = localStorage.getItem('ai_teaching_platform_keys');
          if (savedKeys && savedKeys.includes('test_key_')) {
            logArea.textContent += ' ✅ 正常\n';
          } else {
            logArea.textContent += ' ❌ 異常\n';
          }
          
          // 恢復原始金鑰
          this.state.apiKeys = originalKeys;
          this.saveState();
          
        } catch (error) {
          logArea.textContent += ` ❌ 錯誤: ${error.message}\n`;
        }
      }
      
      // 更新測試結果
      updateTestResults() {
        // 更新測試結果顯示
        const testApiElement = document.getElementById('testApi');
        const testCodeElement = document.getElementById('testCode');
        const testIpoElement = document.getElementById('testIpo');
        const testTeachElement = document.getElementById('testTeach');
        
        // 這裡可以根據實際測試結果更新狀態
        // 目前先顯示基本狀態
        testApiElement.textContent = this.state.apiKeys.deepseek || this.state.apiKeys.openrouter ? '已設定' : '未設定';
        testApiElement.style.color = this.state.apiKeys.deepseek || this.state.apiKeys.openrouter ? 
          'var(--success)' : 'var(--danger)';
          
        testCodeElement.textContent = this.state.projectData.code ? '已生成' : '待生成';
        testCodeElement.style.color = this.state.projectData.code ? 
          'var(--success)' : 'var(--warning)';
          
        testIpoElement.textContent = this.state.projectData.ipo ? '已完成' : '待完成';
        testIpoElement.style.color = this.state.projectData.ipo ? 
          'var(--success)' : 'var(--warning)';
          
        testTeachElement.textContent = this.state.progress.teach ? '已生成' : '待生成';
        testTeachElement.style.color = this.state.progress.teach ? 
          'var(--success)' : 'var(--warning)';
      }
      
      // 更新系統狀態
      updateSystemStatus() {
        // 更新連接狀態
        const hasApiKey = this.state.apiKeys.deepseek || this.state.apiKeys.openrouter;
        document.getElementById('statusConnection').textContent = hasApiKey ? '已連接' : '未連接';
        document.getElementById('statusConnection').style.color = hasApiKey ? 
          'var(--success)' : 'var(--danger)';
          
        // 更新模型狀態
        const model = this.models[this.state.currentModel];
        document.getElementById('statusModel').textContent = model.name;
        
        // 更新進度
        this.updateProgressDisplay();
      }
      
      // 更新UI
      updateUI() {
        this.updateSystemStatus();
        this.updateModelStatus();
        this.updateTestResults();
        this.updateKeyDisplays();
      }
      
      // 顯示狀態訊息
      showStatus(message, elementId, type = 'info') {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const typeClass = `status-${type}`;
        const icon = type === 'success' ? '✅' : 
                     type === 'warning' ? '⚠️' : 
                     type === 'error' ? '❌' : 'ℹ️';
        
        element.innerHTML = `<div class="status ${typeClass}">${icon} ${message}</div>`;
        
        // 5秒後自動清除
        setTimeout(() => {
          if (element.innerHTML.includes(message)) {
            element.innerHTML = '';
          }
        }, 5000);
      }
      
      // 更新程式碼預覽
      updateCodePreview() {
        // 簡化版本，如有需要可擴充
      }
      
      // 更新IPO驗證
      updateIPOValidation() {
        // 簡化版本，如有需要可擴充
      }
      
      // 儲存當前狀態
      saveCurrentState() {
        this.saveState();
        this.showStatus('💾 平台狀態已儲存', 'homeStatus', 'success');
      }
      
      // 重置平台
      resetPlatform() {
        if (confirm('確定要重置平台嗎？這將清除所有未儲存的資料。')) {
          localStorage.removeItem('ai_teaching_platform_state');
          localStorage.removeItem('ai_teaching_platform_progress');
          location.reload();
        }
      }
      
      // 創建備份
      createBackup() {
        try {
          const backup = {
            state: this.state,
            timestamp: new Date().toISOString()
          };
          sessionStorage.setItem('ai_teaching_backup', JSON.stringify(backup));
        } catch (error) {
          console.error('創建備份失敗:', error);
        }
      }
    }

    // 初始化平台
    document.addEventListener('DOMContentLoaded', () => {
      const platform = new AIEducationPlatform();
      window.platform = platform; // 方便除錯
      
      // 添加控制台提示
      console.log('%c🚀 AI教學平台已啟動', 'font-size: 16px; color: #4f46e5; font-weight: bold;');
      console.log('%c📚 版本：大學教學專用穩定版 v2.0', 'color: #7c3aed;');
      console.log('%c💡 提示：使用 Ctrl+數字鍵快速切換頁面', 'color: #10b981;');
      console.log('%c🔧 功能：修正流程順序，API金鑰永久儲存', 'color: #f59e0b;');
      console.log('%c💾 儲存：API金鑰自動永久儲存在本地', 'color: #06b6d4;');
      
      // 顯示歡迎訊息
      setTimeout(() => {
        platform.showStatus('🎉 歡迎使用AI教學平台！請從「模型設定」開始您的教學流程。', 'homeStatus', 'info');
      }, 1000);
    });
  </script>
</body>
</html>